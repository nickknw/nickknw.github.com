<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang="en">
    <head>
	<meta http-equiv="Content-Type" content="text/html;charset=utf-8" >
	<meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0" />
        <meta name="description" content="">

        <title>Word Frequency - Nick Knowlson</title>

        <link rel="stylesheet" type="text/css" href="/css/site.css" >
        <link rel="stylesheet" type="text/css" href="/css/syntax.css" >
	<link rel="shortcut icon" href="/favicon.ico" />
	<link rel="apple-touch-icon-precomposed" href="/favicon.ico" >
        <link href="http://feeds.feedburner.com/NickKnowlson" type="application/atom+xml" rel="alternate" title="Blog ATOM Feed" />
        <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.6.1/jquery.min.js" type="text/javascript"></script>
        <script type="text/javascript">
        if (typeof jQuery == 'undefined')
        {
            document.write(decodeURIComponent("%3Cscript src='/js/jquery-1.6.1.min.js' type='text/javascript'%3E%3C/script%3E"));
        }
        </script>
        

        
        <link rel="stylesheet" type="text/css" href="/css/jquery.lightbox-0.5.css" >
        <script src="/js/jquery.lightbox-0.5.pack.js"></script>
        <script type="text/javascript">
            $(function() { 
                $('#gallery a').lightBox({
                    fixedNavigation:true,
                    imageLoading: '/img/lightbox-ico-loading.gif',
                    imageBlank: '/img/lightbox-blank.gif',
                    imageBtnClose: '/img/lightbox-btn-close.gif',
                    imageBtnPrev: '/img/lightbox-btn-prev.gif',
                    imageBtnNext: '/img/lightbox-btn-next.gif'
                });
            });
        </script>
        
        <script type="text/javascript">
        // TODO: convert to css hover sometime
        $(document).ready(function () {
            $("#rss-nav-icon img").hover(function () {
                $(this).attr("src","/img/rss-icon-lit.png");
            }, function() {
                $(this).attr("src","/img/rss-icon-dim.png");
            });
            $("#twitter-nav-icon img").hover(function () {
                $(this).attr("src","/img/twitter-icon-lit.png");
            }, function() {
                $(this).attr("src","/img/twitter-icon-dim.png");
            });
        });
        </script>
        <script type="text/javascript">
          var _gaq = _gaq || [];

          if (document.location.hostname !== "localhost") {
              _gaq.push(['_setAccount', 'UA-24781362-1']);
              _gaq.push(['_trackPageview']);

              (function() {
                var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
                ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
                var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
              })();
          }
        </script>
    </head>
    <body>
	<div id="header" class="grid grid-16">
            <a href="/"><img src="/img/logos/logo6.png" alt="logo" /></a>
            <ul id="nav">
                <li><a class=" nav-link" href="/">Home</a></li>
                <li><a class=" nav-link" href="/about/">About</a></li>
                <li><a class="selected nav-link" href="/projects/">Projects</a></li>
                <li><a class=" nav-link" href="/blog/">Blog</a></li>
                <li><a class=" nav-link" href="/contact/">Contact</a></li>
                <li><a id="rss-nav-icon" href="http://feeds.feedburner.com/NickKnowlson"><img src="/img/rss-icon-dim.png" /></a></li>
                <li><a id="twitter-nav-icon" href="http://twitter.com/#!/nickknw"><img src="/img/twitter-icon-dim.png" /></a></li>
            </ul>
	</div>

        <div id="content" class="grid grid-16" style="background-color:white; clear:both;">
            <div id="content-padding">
                <p> <a href="/projects/">&laquo; Back to projects</a></p>

<img class="project_thumbnail" style="float: right;" src="/img/projects/word-frequency/thumb.png">
<h1 style="">Word Frequency</h1>
<div><strong>Languages: </strong>Ruby</div>
<div><strong>Summary: </strong>Scripts to conveniently do word and string frequency analysis on source code.</div>

<div style="margin-bottom:.75em;"><strong>Source code: </strong><a href="http://github.com/nickknw/word_frequency">github</a> <span style="font-size:.85em">[<a href="http://github.com/nickknw/word_frequency/tarball/master">.tar.gz</a> / <a href="http://github.com/nickknw/word_frequency/zipball/master">.zip</a>]</span></div>




<h2>Details</h2>
<p><p>My word_frequency script counts the number of times a each word (or phrase) occurs in a programming project and produces a sorted list of which ones appear most frequently. It helps identify simple trends and recurring patterns and is most useful when trying to get familiar with a new codebase.</p><p>It answers the questions &#8220;What is the most frequently occurring phrase in this project that is 1 word long? What about 2 words long? What about 8?&#8221; etc.</p><p>At low word counts, it mostly reflects the keywords of the language, as you would expect. Once you get into higher counts it can reveal interesting things about patterns in the code, as well as code duplication.</p><h2 id='usage'>Usage</h2><div class='highlight'><pre><code class='bash'><span class='nb'>cd </span>my_csharp_project
ruby word_frequency.rb 1 cs

<span class='nb'>cd</span> ../my_website
ruby word_frequency.rb 5 js
</code></pre></div><h2 id='string_frequency'>String Frequency</h2><p>I made an alternate version of the previous tool with one modification: it only searches inside of string literals in the source code. It is good for finding out there are 89 occurrences of <code>&quot;SELECT * FROM&quot;</code> (among other things). This version might be more useful for finding actual problems with code than the initial version.</p><p>It should ideally be merged with <code>word_frequency.rb</code> and be enabled with a flag, but for now it works well enough as is.</p><h2 id='example'>Example</h2><p>I&#8217;m going to use <a href='http://sourceforge.net/projects/dwsim/'>DWSIM</a> for this example. DWSIM is an open source chemical process simulator written in VB.NET. I am using it as an example for my VB.NET Signature Survey project because it is big, open source, and written in VB.NET. Since I already had it handy for that one, I&#8217;ll use it here too.</p><p><strong>Generate the word frequency files</strong></p><p>I started out by creating a convenience script for running word_frequency and string_frequency multiple times:</p><div class='highlight'><pre><code class='ruby'><span class='n'>ext</span> <span class='o'>=</span> <span class='no'>ARGV</span><span class='o'>[</span><span class='mi'>0</span><span class='o'>]</span>

<span class='p'>(</span><span class='mi'>1</span><span class='o'>.</span><span class='n'>.</span><span class='mi'>15</span><span class='p'>)</span><span class='o'>.</span><span class='n'>each</span> <span class='p'>{</span><span class='o'>|</span><span class='n'>num</span><span class='o'>|</span>
    <span class='nb'>puts</span> <span class='sb'>`ruby -E &#39;iso-8859-1&#39; word_frequency.rb </span><span class='si'>#{</span><span class='n'>num</span><span class='si'>}</span><span class='sb'> </span><span class='si'>#{</span><span class='n'>ext</span><span class='si'>}</span><span class='sb'>`</span>
<span class='p'>}</span>

<span class='p'>(</span><span class='mi'>1</span><span class='o'>.</span><span class='n'>.</span><span class='mi'>15</span><span class='p'>)</span><span class='o'>.</span><span class='n'>each</span> <span class='p'>{</span><span class='o'>|</span><span class='n'>num</span><span class='o'>|</span>
    <span class='nb'>puts</span> <span class='sb'>`ruby -E &#39;iso-8859-1&#39; string_frequency.rb </span><span class='si'>#{</span><span class='n'>num</span><span class='si'>}</span><span class='sb'> </span><span class='si'>#{</span><span class='n'>ext</span><span class='si'>}</span><span class='sb'>`</span>
<span class='p'>}</span>
</code></pre></div><p>For now I have to specify the external encoding when running the scripts, as the default behavior for ruby is to assume the files are UTF-8. This ends up in my script throwing an error when it gets to a character like &#169;. There must be a better way to handle files with unknown encodings from within the script, but for now this works.</p><p>So, I copied the above script along with <code>word_frequency.rb</code> and <code>string_frequency.rb</code> to the root of the DWSIM project and ran it:</p><div class='highlight'><pre><code class='bash'>ruby runboth.rb vb
</code></pre></div><p>The script should have created a subdirectory called <code>wordfreq</code> in the current directory. Let&#8217;s see what&#8217;s in there:</p><div class='highlight'><pre><code class='bash'>nick@Mengsk:~/prog/word_frequency/dwsim<span class='nv'>$ </span>ls -lh wordfreq/
total 12M
-rw-r--r-- 1 nick nick  802K 2011-08-01 15:22 dwsim-01words.vb.wordfreq
-rw-r--r-- 1 nick nick  1.3M 2011-08-01 15:22 dwsim-02words.vb.wordfreq
-rw-r--r-- 1 nick nick  1.5M 2011-08-01 15:22 dwsim-03words.vb.wordfreq
-rw-r--r-- 1 nick nick  1.4M 2011-08-01 15:23 dwsim-04words.vb.wordfreq
-rw-r--r-- 1 nick nick  1.3M 2011-08-01 15:23 dwsim-05words.vb.wordfreq
-rw-r--r-- 1 nick nick  1.2M 2011-08-01 15:23 dwsim-06words.vb.wordfreq
-rw-r--r-- 1 nick nick  1.1M 2011-08-01 15:23 dwsim-07words.vb.wordfreq
-rw-r--r-- 1 nick nick 1014K 2011-08-01 15:23 dwsim-08words.vb.wordfreq
-rw-r--r-- 1 nick nick  950K 2011-08-01 15:23 dwsim-09words.vb.wordfreq
-rw-r--r-- 1 nick nick  873K 2011-08-01 15:23 dwsim-10words.vb.wordfreq
-rw-r--r-- 1 nick nick   75K 2011-08-01 15:23 dwsim-stringsonly-01words.vb.wordfreq
-rw-r--r-- 1 nick nick   34K 2011-08-01 15:23 dwsim-stringsonly-02words.vb.wordfreq
-rw-r--r-- 1 nick nick   26K 2011-08-01 15:23 dwsim-stringsonly-03words.vb.wordfreq
-rw-r--r-- 1 nick nick   22K 2011-08-01 15:23 dwsim-stringsonly-04words.vb.wordfreq
-rw-r--r-- 1 nick nick   20K 2011-08-01 15:23 dwsim-stringsonly-05words.vb.wordfreq
-rw-r--r-- 1 nick nick   20K 2011-08-01 15:23 dwsim-stringsonly-06words.vb.wordfreq
-rw-r--r-- 1 nick nick   19K 2011-08-01 15:23 dwsim-stringsonly-07words.vb.wordfreq
-rw-r--r-- 1 nick nick   19K 2011-08-01 15:23 dwsim-stringsonly-08words.vb.wordfreq
-rw-r--r-- 1 nick nick   18K 2011-08-01 15:23 dwsim-stringsonly-09words.vb.wordfreq
-rw-r--r-- 1 nick nick   17K 2011-08-01 15:23 dwsim-stringsonly-10words.vb.wordfreq
</code></pre></div><p>Looks correct to me. One interesting thing to note is the file size will tend to decrease as the number of words in a phrase increases.</p><p><strong>Analyze the generated files</strong></p><p>Now on to the interesting part!</p><p>I&#8217;m going to start at the top and work my way downwards.</p><p>In <code>dwsim-01words.vb.wordfreq</code>, the top few results are pretty predictable:</p><pre><code>Word Frequency List:
  72445: = 
  29758: As 
  19457: End 
  16282: * 
  14307: If 
  13604: + 
  12354: &#39; 
  11034: Dim </code></pre><p>Language keywords and operators. I&#8217;d worry if this wasn&#8217;t the case.</p><p>Now for some more interesting results:</p><pre><code>   7904: Public 
   1655: Private 
    743: Protected </code></pre><p>There are quite a lot more public functions than private ones. It doesn&#8217;t say much by itself, but learning the reason this project has this ratio could be enlightening. It might be an indicator of poor encapsulation, or just that this project has a large public API.</p><pre><code>   4969: Sub 
   3515: Function </code></pre><p>In VB.NET, a Sub is just a Function that doesn&#8217;t return any values. In C-style languages this is represented by using a <code>void</code> return type. This suggests that most methods rely on modifying shared state to make their results known. It might be explained by other things as well, but this is something I&#8217;d keep an eye out for while reading through the code.</p><pre><code>   5986: ByVal 
    491: ByRef </code></pre><p>In VB.NET you only need to use ByRef if you want to modify a passed in <em>value</em> type (not reference type). It&#8217;s not something that should usually happen a lot, so seeing a lot of usages of ByRef could indicate a misunderstanding of what that keyword actually does or an alarming amount of modifying value type parameters.</p><p>As I go through the rest of the files, I am more looking for phrases that are repeated a surprising number of times. I try and follow the phrases through the files to see what they turn into and at one point they diverge into two phrases, etc. Here are some notes I took as I went through:</p><pre><code>02

   1022: &#39;UPGRADE_WARNING: Couldn&#39;t resolve 
    362: CSng(X + 
    356: Width), CSng(Y 
    348: * 1.25 
    346: 2 + 
    334: Or Vids(i) 
    330: Return valor 
    325: (1 + 
    289: = temp1(2, </code></pre><p>Looks like some possible repeated formulas.</p><pre><code>03

   2192: i = 0 
   1521: = n + 
   1510: n + 1 
   1022: &#39;UPGRADE_WARNING: Couldn&#39;t resolve 
    356: Width), CSng(Y + 
    348: * 1.25 * 
    338: ^ 2 + 
    185: = temp1(2, 0) 
    143: Return valor * 
    138: Return valor / </code></pre><p>Not sure what the <code>i = 0</code>, <code>= n + 1</code> stuff is about yet, probably looping related. Notice <code>Return valor</code> has started splitting. It continues to split into fragments like <code>13: Return valor / 3600</code>. I won&#8217;t include it from here on but it would be worth looking into why it does this.</p><pre><code>04
   1467: Looks up a localized 
   1387: Loop Until i = 
   1382: = i + 1 
   1022: &#39;UPGRADE_WARNING: Couldn&#39;t resolve default 
    598: i = 0 To 
    591: For i = 0 
    356: Width), CSng(Y + 
    257: RET_VKij(), RET_VTC, RET_VPC, RET_VW, 
    193: * 1.25 * Width), 
    106: &gt; temp1(2, 0) Then 
     73: ^ 2 + (pt.Y </code></pre><p>Yep, looping related. I also start noticing <code>RET_VKij()</code> as the extraneous repeated stuff thins out.</p><pre><code>05
   1467: Looks up a localized string 
   1022: Couldn&#39;t resolve default property of 
    180: T, P, RET_VMOL(fase1), RET_VKij(), RET_VMAS(fase1), 
    127: * 1.25 * Width), CSng(Y 
    106: 0) &gt; temp1(2, 0) Then 
     40: alpha(i) = (1 + (0.37464 
     40: RET_VTC, RET_VPC, RET_VW, Me.RET_Hid(298.15, T, 
     36: (1 + 2 ^ 0.5) 

06
   1467: &#39;&#39;&#39; Looks up a localized string 
   1022: &#39;UPGRADE_WARNING: Couldn&#39;t resolve default property of 
    180: T, P, RET_VMOL(fase1), RET_VKij(), RET_VMAS(fase1), RET_VTC(), 
    127: * 1.25 * Width), CSng(Y + 
    110: Return Me.m_props.CpCvR(&quot;L&quot;, T, P, RET_VMOL(fase1), RET_VKij(), 
     40: alpha(i) = (1 + (0.37464 + </code></pre><p><code>temp1(2, 0)</code> splits off into two here, for brevity&#8217;s sake I won&#8217;t continue listing it here, although I think it would be worth a follow-up. First time I notice <code>Return Me.m\_props</code>, which continues showing up for a while. and eventually shows itself to be tied to <code>T, P, RET_VMOL</code>.</p><pre><code>07</code></pre><p>Here the <code>&#39;UPGRADE WARNING: Couldn&#39;t resolve default property of</code> splits off into things like: object pressure, temperature, tau, density, pSatW&#8230; I didn&#8217;t record the full list. Looks like it probably is something generated by a tool. (Confirmed later)</p><pre><code>08
   1467: &#39;&#39;&#39; Looks up a localized string similar to 
    180: T, P, RET_VMOL(fase1), RET_VKij(), RET_VMAS(fase1), RET_VTC(), RET_VPC(), RET_VCP(T), 
    110: Return Me.m_props.CpCvR(&quot;L&quot;, T, P, RET_VMOL(fase1), RET_VKij(), RET_VMAS(fase1), RET_VTC(), 
     30: alpha(i) = (1 + (0.37464 + 1.54226 * W(i) </code></pre><p>This is the last time we see <code>&#39;&#39;&#39; Looks up a localized string similar to</code> as a high number, it splits off into many names. Definitely generated by a tool as well. <code>1.25 * Width</code> has now split into at least two by now as well. It still seems odd to me, so I would look into why later.</p><p>I&#8217;m going to skip a bit here and list the rest of the phrases that I would follow up on (if I were really learning my way around this project).</p><pre><code>180: T, P, RET_VMOL(fase1), RET_VKij(), RET_VMAS(fase1), RET_VTC(), RET_VPC(), RET_VCP(T), RET_VMM(), RET_VW(), 
110: Return Me.m_props.CpCvR(&quot;L&quot;, T, P, RET_VMOL(fase1), RET_VKij(), RET_VMAS(fase1), RET_VTC(), RET_VPC(), RET_VCP(T), RET_VMM(), 
 65: / 1000 * subst.ConstantProperties.Molar_Weight / Me.m_props.liq_dens_rackett(T, subst.ConstantProperties.Critical_Temperature, subst.ConstantProperties.Critical_Pressure, subst.ConstantProperties.Acentric_Factor, subst.ConstantProperties.Molar_Weight, subst.ConstantProperties.Z_Rackett, P, 
 30: alpha(i) = (1 + (0.37464 + 1.54226 * W(i) - 0.26992 </code></pre><p>Might be some opportunities to get rid of magic numbers and refactor a bit.</p><p><strong>String-only</strong></p><p>The last section turned out quite a bit longer than I expected, fortunately this one turned out much much shorter! In this project I saw nothing to call attention to in the string frequency list. There are maybe a couple of opportunities to put some strings in a resource file, but that&#8217;s it.</p><p>I will keep running the strings-only part in the future though, just because of that one (small!) codebase where I really did find over a hundred uses of <code>&quot;SELECT *
FROM&quot;</code>.</p></p>


<div id="socialbuttons">
<div>
    <div id="rss_button"><a href="http://feeds.feedburner.com/NickKnowlson"><img src="/img/feed-icon-28x28.png">&nbsp;</a></div>
    <!-- G+ -->
    <div id="google_plus_button"><g:plusone></g:plusone>
    <script type="text/javascript">
      (function() {
        var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
        po.src = 'https://apis.google.com/js/plusone.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
      })();
    </script></div>

    <!-- Twitter -->
    <div id="twitter_button"><a href="http://twitter.com/share" class="twitter-share-button" data-count="horizontal" data-via="nickknw">Tweet</a>
    <script type="text/javascript" src="http://platform.twitter.com/widgets.js"></script></div>

    <!-- Reddit -->
    <div id="reddit_button"><script type="text/javascript" src="http://www.reddit.com/static/button/button1.js"></script></div>

    <!-- Facebook -->
    <div id="facebook_button"><div id="fb-root"></div> <script src="http://connect.facebook.net/en_US/all.js#appId=122515937846861&amp;xfbml=1"></script><fb:like href="http://nickknowlson.com/projects/word_frequency/" send="false" layout="button_count" width="320" show_faces="true" action="like" font=""></fb:like></div>

</div>
</div>




            </div>
        </div>
        <div id="footer">&copy; Copyright 2013 Nick Knowlson</div>
        <div style="display: none;">Content by Nick Knowlson: <a href="https://plus.google.com/104462106474002996122?rel=author" rel="me">Google+</a></div>
        <!--hacky way of reducing image loading lag when hovering over rss and twitter icons for now --><span style="display: none;"><img src="/img/rss-icon-lit.png" /><img src="/img/twitter-icon-lit.png" /></span>
    </body>
</html>
