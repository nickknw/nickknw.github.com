<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang="en">
    <head>
	<meta http-equiv="Content-Type" content="text/html;charset=utf-8" >
	<meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0" />
        <meta name="description" content="The latest blog posts by Nick Knowlson.">

        <title>Blog - Nick Knowlson</title>

        <link rel="stylesheet" type="text/css" href="/css/site.css" >
        <link rel="stylesheet" type="text/css" href="/css/syntax.css" >
	<link rel="shortcut icon" href="/favicon.ico" />
	<link rel="apple-touch-icon-precomposed" href="/favicon.ico" >
        <link href="http://feeds.feedburner.com/NickKnowlson" type="application/atom+xml" rel="alternate" title="Blog ATOM Feed" />
        <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.6.1/jquery.min.js" type="text/javascript"></script>
        <script type="text/javascript">
        if (typeof jQuery == 'undefined')
        {
            document.write(decodeURIComponent("%3Cscript src='/js/jquery-1.6.1.min.js' type='text/javascript'%3E%3C/script%3E"));
        }
        </script>
        

        
        <script type="text/javascript">
        // TODO: convert to css hover sometime
        $(document).ready(function () {
            $("#rss-nav-icon img").hover(function () {
                $(this).attr("src","/img/rss-icon-lit.png");
            }, function() {
                $(this).attr("src","/img/rss-icon-dim.png");
            });
            $("#twitter-nav-icon img").hover(function () {
                $(this).attr("src","/img/twitter-icon-lit.png");
            }, function() {
                $(this).attr("src","/img/twitter-icon-dim.png");
            });
        });
        </script>
        <script type="text/javascript">
          var _gaq = _gaq || [];

          if (document.location.hostname !== "localhost") {
              _gaq.push(['_setAccount', 'UA-24781362-1']);
              _gaq.push(['_trackPageview']);

              (function() {
                var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
                ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
                var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
              })();
          }
        </script>
    </head>
    <body>
	<div id="header" class="grid grid-16">
            <a href="/"><img src="/img/logos/logo6.png" alt="logo" /></a>
            <ul id="nav">
                <li><a class=" nav-link" href="/">Home</a></li>
                <li><a class=" nav-link" href="/about/">About</a></li>
                <li><a class=" nav-link" href="/projects/">Projects</a></li>
                <li><a class="selected nav-link" href="/blog/">Blog</a></li>
                <li><a class=" nav-link" href="/contact/">Contact</a></li>
                <li><a id="rss-nav-icon" href="http://feeds.feedburner.com/NickKnowlson"><img src="/img/rss-icon-dim.png" /></a></li>
                <li><a id="twitter-nav-icon" href="http://twitter.com/#!/nickknw"><img src="/img/twitter-icon-dim.png" /></a></li>
            </ul>
	</div>

        <div id="content" class="grid grid-16" style="background-color:white; clear:both;">
            <div id="content-padding">
                <div style="text-align:center;"><b>Latest Posts</b> | <a href="/blog/archive/">Archive</a></div>

  <div>
  <h1 style="margin:0px"><a href="/blog/2012/08/06/seven-languages-week-3-day-3/">
  Seven Languages: Week 3 (Prolog) - Day 3
  </a></h1>
  <div class="faded" style="font-size:14px; margin-bottom:5px;">06 Aug 2012</div>
  <p>Day 3 tackled some bigger examples: solving sudoku and the eight queens problem. In today&#8217;s post however, I&#8217;m going to go a bit off the rails and talk a bit about how logic programming can be beneficial in more practical ways.</p>
<div class='interjection'><p>
(This article is part of a series of posts I am doing about my journey through the exercises of the book <a href='http://pragprog.com/book/btlang/seven-languages-in-seven-weeks'>Seven Languages In Seven Weeks</a>. The article previous to this one is <a href='/blog/2012/07/17/seven-languages-week-3-day-2/'>Week 3 (Prolog) - Day 2</a>. For an overview see the <a href='/projects/seven-languages-in-seven-weeks/'>project page</a>.)
</p></div><h3>Datalog</h3>
<p>Datalog is a subset of Prolog oriented towards querying that was designed to be embeddable in other languages. Many languages have datalog engines, such as <a href='http://iris-reasoner.org/'>Java</a>, <a href='https://sites.google.com/site/pydatalog/'>Python</a>, <a href='http://code.google.com/p/clojure-contrib/wiki/DatalogOverview'>Clojure</a> and <a href='http://docs.racket-lang.org/datalog/'>Racket</a>. It has become more well-known recently for being the query language of choice for <a href='http://www.datomic.com/'>Datomic</a>, a promising new distributed database. <a href='http://blog.fogus.me/'>Michael Fogus</a> is even giving a talk at this upcoming <a href='https://thestrangeloop.com/'>Strange Loop</a> about <a href='https://thestrangeloop.com/sessions/the-reemergence-of-datalog'>&#8220;The Reemergence of Datalog&#8221;</a>.</p>
<h3>Constraint Programming</h3>
<p>Every time in these past examples when I use the Prolog library <code>clp(fd)</code> (which stands for Constraint Logic Programming over a Finite Domain), I&#8217;m doing constraint programming. A lot of the time it is mixed in with logic programming, but it <em>doesn&#8217;t have to be</em>: there are constraint programming libraries for a lot of other languages. It can be really beneficial to know how to use even if you never write a line of Prolog.</p>

<p>In fact, the prolog solution to sudoku below owes a lot of its conciseness to constraint programming. Sudoku solver implementations in other languages that have a constraint programming library can be about the same length! Another property of solutions using constraints is that they are usually a lot faster than an equivalent logic programming only solution.</p>
<h3>Other logic languages</h3>
<p>Prolog is the most widely used logic language, but it isn&#8217;t the only one. Here are a few other interesting ones that caught my eye.</p>

<ul>
<li><a href='http://www.mercury.csse.unimelb.edu.au/'>Mercury</a> is a functional logic programming language that shares Prolog&#8217;s syntax but has a strong static type system.</li>

<li><a href='http://www-ps.informatik.uni-kiel.de/currywiki/'>Curry</a> is a functional logic programming language based on Haskell. It has constraint programming support built in.</li>

<li><a href='http://www.mozart-oz.org/'>Oz</a> is a dynamically typed multi-paradigm language. The (reportedly excellent) book <a href='http://www.info.ucl.ac.be/~pvr/book.html'>Concepts, Techniques, and Models of Computer Programming</a> uses Oz as its language of choice.</li>
</ul>
<h3>Logic libraries</h3>
<p>Surprisingly, you can get logic programming functionality in library form as well! These libraries are less common than constraint programming libraries, I could only find a few:</p>

<ul>
<li>Scheme: <a href='http://kanren.sourceforge.net/'>Kanren</a>, miniKanren and <a href='https://github.com/calvis/cKanren'>cKanren</a>. Kanren is the original implementation, miniKanren is a simplified implementation (~300 lines) for ease of teaching, and cKanren modifies miniKanren to support constraint logic programming.</li>

<li>Clojure: <a href='https://github.com/clojure/core.logic/'>core.logic</a>. This library was actually based off of miniKanren originally, and cKanren functionality is currently in progress.</li>

<li>C++: <a href='http://people.cs.umass.edu/~yannis/lc++/'>LC++</a></li>
</ul>

<h2 id='highlights_from_exercises'>Highlights from exercises</h2>

<p>The exercises in this chapter were pretty interesting, but also pretty exhausting for a newbie to logic programming. I ended up with two implementations of a sudoku solver. The second one was about a fifth the size of the first and I learned a ton in the process of writing it. I think my implementation is fairly readable, so if you&#8217;re interested please feel free to scroll down to the <a href='#formatted_solutions'>formatted solutions</a> and take a look.</p>

<p>That&#8217;s not what I&#8217;ll be highlighting here though. I&#8217;ll be pitting a Prolog solution against a solution from a regular (i.e. not logical) programming language that uses a constraint programming library. Since next week is Scala, I&#8217;ll arbitrarily pick Scala as the language and <a href='http://www.jacop.eu/'>JaCoP</a> as the constraint programming library. This is a light comparison done for my own fun and enlightenment, it isn&#8217;t meant to be comprehensive.</p>

<p>Since I&#8217;m just a beginner with logic and constraint programming, it would be meaningless to compare implementations I wrote myself; the properties of the solutions would have more to do with my limitations than the languages they&#8217;re written in. So for these examples I will be leaning on more experienced minds.</p>
<h3>Prolog</h3>
<p>This Prolog solution is taken from the <a href='http://www.swi-prolog.org/man/clpfd.html'>clp(fd) documentation</a>.</p>
<div class='highlight'><pre><code class='prolog'><span class='p'>:-</span> <span class='nf'>use_module</span><span class='p'>(</span><span class='nf'>library</span><span class='p'>(</span><span class='s-Atom'>clpfd</span><span class='p'>)).</span>

<span class='nf'>sudoku</span><span class='p'>(</span><span class='nv'>Rows</span><span class='p'>)</span> <span class='p'>:-</span>
        <span class='nf'>length</span><span class='p'>(</span><span class='nv'>Rows</span><span class='p'>,</span> <span class='m'>9</span><span class='p'>),</span> <span class='nf'>maplist</span><span class='p'>(</span><span class='nf'>length_</span><span class='p'>(</span><span class='m'>9</span><span class='p'>),</span> <span class='nv'>Rows</span><span class='p'>),</span>
        <span class='nf'>append</span><span class='p'>(</span><span class='nv'>Rows</span><span class='p'>,</span> <span class='nv'>Vs</span><span class='p'>),</span> <span class='nv'>Vs</span> <span class='s-Atom'>ins</span> <span class='m'>1</span><span class='p'>..</span><span class='m'>9</span><span class='p'>,</span>
        <span class='nf'>maplist</span><span class='p'>(</span><span class='s-Atom'>all_distinct</span><span class='p'>,</span> <span class='nv'>Rows</span><span class='p'>),</span>
        <span class='nf'>transpose</span><span class='p'>(</span><span class='nv'>Rows</span><span class='p'>,</span> <span class='nv'>Columns</span><span class='p'>),</span> <span class='nf'>maplist</span><span class='p'>(</span><span class='s-Atom'>all_distinct</span><span class='p'>,</span> <span class='nv'>Columns</span><span class='p'>),</span>
        <span class='nv'>Rows</span> <span class='o'>=</span> <span class='p'>[</span><span class='nv'>A</span><span class='p'>,</span><span class='nv'>B</span><span class='p'>,</span><span class='nv'>C</span><span class='p'>,</span><span class='nv'>D</span><span class='p'>,</span><span class='nv'>E</span><span class='p'>,</span><span class='nv'>F</span><span class='p'>,</span><span class='nv'>G</span><span class='p'>,</span><span class='nv'>H</span><span class='p'>,</span><span class='nv'>I</span><span class='p'>],</span>
        <span class='nf'>blocks</span><span class='p'>(</span><span class='nv'>A</span><span class='p'>,</span> <span class='nv'>B</span><span class='p'>,</span> <span class='nv'>C</span><span class='p'>),</span> <span class='nf'>blocks</span><span class='p'>(</span><span class='nv'>D</span><span class='p'>,</span> <span class='nv'>E</span><span class='p'>,</span> <span class='nv'>F</span><span class='p'>),</span> <span class='nf'>blocks</span><span class='p'>(</span><span class='nv'>G</span><span class='p'>,</span> <span class='nv'>H</span><span class='p'>,</span> <span class='nv'>I</span><span class='p'>).</span>

<span class='nf'>length_</span><span class='p'>(</span><span class='nv'>L</span><span class='p'>,</span> <span class='nv'>Ls</span><span class='p'>)</span> <span class='p'>:-</span> <span class='nf'>length</span><span class='p'>(</span><span class='nv'>Ls</span><span class='p'>,</span> <span class='nv'>L</span><span class='p'>).</span>

<span class='nf'>blocks</span><span class='p'>([],</span> <span class='p'>[],</span> <span class='p'>[]).</span>
<span class='nf'>blocks</span><span class='p'>([</span><span class='nv'>A</span><span class='p'>,</span><span class='nv'>B</span><span class='p'>,</span><span class='nv'>C</span><span class='p'>|</span><span class='nv'>Bs1</span><span class='p'>],</span> <span class='p'>[</span><span class='nv'>D</span><span class='p'>,</span><span class='nv'>E</span><span class='p'>,</span><span class='nv'>F</span><span class='p'>|</span><span class='nv'>Bs2</span><span class='p'>],</span> <span class='p'>[</span><span class='nv'>G</span><span class='p'>,</span><span class='nv'>H</span><span class='p'>,</span><span class='nv'>I</span><span class='p'>|</span><span class='nv'>Bs3</span><span class='p'>])</span> <span class='p'>:-</span>
        <span class='nf'>all_distinct</span><span class='p'>([</span><span class='nv'>A</span><span class='p'>,</span><span class='nv'>B</span><span class='p'>,</span><span class='nv'>C</span><span class='p'>,</span><span class='nv'>D</span><span class='p'>,</span><span class='nv'>E</span><span class='p'>,</span><span class='nv'>F</span><span class='p'>,</span><span class='nv'>G</span><span class='p'>,</span><span class='nv'>H</span><span class='p'>,</span><span class='nv'>I</span><span class='p'>]),</span>
        <span class='nf'>blocks</span><span class='p'>(</span><span class='nv'>Bs1</span><span class='p'>,</span> <span class='nv'>Bs2</span><span class='p'>,</span> <span class='nv'>Bs3</span><span class='p'>).</span>
</code></pre>
</div><h3>Scala + JaCoP</h3>
<p>This Scala solution is taken from <a href='http://www.hakank.org/constraint_programming_blog/2011/08/a_first_look_at_scalajacop_scala_wrapper_for_jacop.html'>Hakan Kjellerstrand&#8217;s scalaJaCoP page</a>. Here is a direct link to <a href='http://www.hakank.org/jacop/Sudoku.scala'>the file itself</a>.</p>
<div class='highlight'><pre><code class='scala'><span class='k'>import</span> <span class='nn'>scalaJaCoP._</span>

<span class='k'>object</span> <span class='nc'>Sudoku</span> <span class='k'>extends</span> <span class='nc'>App</span> <span class='k'>with</span> <span class='n'>jacop</span> <span class='o'>{</span>
  <span class='k'>val</span> <span class='n'>n</span> <span class='k'>=</span> <span class='mi'>9</span>
  <span class='k'>val</span> <span class='n'>reg</span> <span class='k'>=</span> <span class='mi'>3</span>

  <span class='c1'>// data</span>
  <span class='k'>val</span> <span class='n'>problem</span> <span class='k'>=</span> <span class='o'>...</span> <span class='c1'>// omitted</span>

  <span class='k'>val</span> <span class='n'>x</span> <span class='k'>=</span> <span class='nc'>List</span><span class='o'>.</span><span class='n'>tabulate</span><span class='o'>(</span><span class='n'>n</span><span class='o'>)(</span><span class='n'>i</span><span class='k'>=&gt;</span> 
                <span class='nc'>List</span><span class='o'>.</span><span class='n'>tabulate</span><span class='o'>(</span><span class='n'>n</span><span class='o'>)(</span><span class='n'>j</span><span class='k'>=&gt;</span>
                  <span class='k'>new</span> <span class='nc'>IntVar</span><span class='o'>(</span><span class='s'>&quot;x(&quot;</span><span class='o'>+</span><span class='n'>i</span><span class='o'>+</span><span class='s'>&quot;,&quot;</span><span class='o'>+</span><span class='n'>j</span><span class='o'>+</span><span class='s'>&quot;)&quot;</span><span class='o'>,</span> <span class='mi'>1</span><span class='o'>,</span> <span class='n'>n</span><span class='o'>)))</span>

  <span class='c1'>// constraints</span>

  <span class='c1'>// fill with the hints</span>
  <span class='k'>for</span><span class='o'>(</span><span class='n'>i</span> <span class='k'>&lt;-</span> <span class='mi'>0</span> <span class='n'>until</span> <span class='n'>n</span><span class='o'>)</span> <span class='o'>{</span>
    <span class='k'>for</span><span class='o'>(</span><span class='n'>j</span> <span class='k'>&lt;-</span> <span class='mi'>0</span> <span class='n'>until</span> <span class='n'>n</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='k'>if</span> <span class='o'>(</span><span class='n'>problem</span><span class='o'>(</span><span class='n'>i</span><span class='o'>)(</span><span class='n'>j</span><span class='o'>)</span> <span class='o'>&gt;</span> <span class='mi'>0</span><span class='o'>)</span> <span class='o'>{</span>
        <span class='n'>x</span><span class='o'>(</span><span class='n'>i</span><span class='o'>)(</span><span class='n'>j</span><span class='o'>)</span> <span class='err'>#</span><span class='k'>=</span> <span class='n'>problem</span><span class='o'>(</span><span class='n'>i</span><span class='o'>)(</span><span class='n'>j</span><span class='o'>)</span>
      <span class='o'>}</span>
    <span class='o'>}</span>
  <span class='o'>}</span>
  
  <span class='c1'>// rows and columns</span>
  <span class='k'>for</span><span class='o'>(</span><span class='n'>i</span> <span class='k'>&lt;-</span> <span class='mi'>0</span> <span class='n'>until</span> <span class='n'>n</span><span class='o'>)</span> <span class='o'>{</span>
    <span class='n'>alldifferent</span><span class='o'>(</span> <span class='nc'>Array</span><span class='o'>.</span><span class='n'>tabulate</span><span class='o'>(</span><span class='n'>n</span><span class='o'>)(</span><span class='n'>j</span><span class='k'>=&gt;</span> <span class='n'>x</span><span class='o'>(</span><span class='n'>i</span><span class='o'>)(</span><span class='n'>j</span><span class='o'>))</span> <span class='o'>)</span>
    <span class='n'>alldifferent</span><span class='o'>(</span> <span class='nc'>Array</span><span class='o'>.</span><span class='n'>tabulate</span><span class='o'>(</span><span class='n'>n</span><span class='o'>)(</span><span class='n'>j</span><span class='k'>=&gt;</span> <span class='n'>x</span><span class='o'>(</span><span class='n'>j</span><span class='o'>)(</span><span class='n'>i</span><span class='o'>))</span> <span class='o'>)</span> 
  <span class='o'>}</span>

  <span class='c1'>// blocks</span>
  <span class='k'>for</span><span class='o'>(</span><span class='n'>i</span> <span class='k'>&lt;-</span> <span class='mi'>0</span> <span class='n'>until</span> <span class='n'>reg</span><span class='o'>;</span> <span class='n'>j</span> <span class='k'>&lt;-</span> <span class='mi'>0</span> <span class='n'>until</span> <span class='n'>reg</span><span class='o'>)</span> <span class='o'>{</span>
    <span class='n'>alldifferent</span><span class='o'>(</span>  <span class='o'>(</span><span class='k'>for</span><span class='o'>{</span> <span class='n'>r</span> <span class='k'>&lt;-</span> <span class='n'>i</span><span class='o'>*</span><span class='n'>reg</span> <span class='n'>until</span> <span class='n'>i</span><span class='o'>*</span><span class='n'>reg</span><span class='o'>+</span><span class='n'>reg</span><span class='o'>;</span>
                        <span class='n'>c</span> <span class='k'>&lt;-</span> <span class='n'>j</span><span class='o'>*</span><span class='n'>reg</span> <span class='n'>until</span> <span class='n'>j</span><span class='o'>*</span><span class='n'>reg</span><span class='o'>+</span><span class='n'>reg</span>
                     <span class='o'>}</span> <span class='k'>yield</span> <span class='n'>x</span><span class='o'>(</span><span class='n'>r</span><span class='o'>)(</span><span class='n'>c</span><span class='o'>)).</span><span class='n'>toArray</span>
               <span class='o'>)</span>
  <span class='o'>}</span>

   <span class='c1'>// search</span>
  <span class='k'>val</span> <span class='n'>result</span> <span class='k'>=</span> <span class='n'>satisfyAll</span><span class='o'>(</span><span class='n'>search</span><span class='o'>(</span><span class='n'>x</span><span class='o'>.</span><span class='n'>flatten</span><span class='o'>,</span> <span class='n'>max_regret</span><span class='o'>,</span> <span class='n'>indomain_max</span><span class='o'>),</span> <span class='n'>printIt</span><span class='o'>)</span> 

  <span class='k'>def</span> <span class='n'>printIt</span><span class='o'>()</span> <span class='o'>{</span> <span class='o'>...</span> <span class='o'>}</span> <span class='c1'>// omitted</span>
<span class='o'>}</span> 
</code></pre>
</div>
<p>For brevity I&#8217;m omitting how the Prolog solution is queried and how the Scala solution is printed. I want to keep the focus on the interesting parts of these programs. For the full source code, check the links above or the <a href='https://github.com/nickknw/constraint-programming-benchmarks'>benchmark source code</a> on github.</p>
<h3>Scoring</h3><h4>Size</h4>
<p>The Prolog program is just over half as long at <strong>13</strong> lines instead of <strong>25</strong> for Scala (not counting comments or whitespace). Although this is definitely a win for Prolog, the Scala version is still far shorter than any Sudoku solvers that don&#8217;t take advantage of constraint programming.</p>
<h4>Readability</h4>
<p>Ah, the most subjective benchmark! This one is hard for me to judge fairly, since I&#8217;ve spent a lot of time inside of Prolog recently, and none using Scala or JaCoP. That said, even trying to account for my bias I think the Prolog solution has a big advantage here. It reads a lot more declaratively than the Scala solution and doesn&#8217;t have to worry about as many details.</p>

<p>Given my bias I would be very interested to hear feedback on this topic. Which solution did <strong>you</strong> think was more readable?</p>
<h4>Speed</h4>
<p>Now we are into interesting territory. Prolog has a few decades&#8217; headstart on JaCoP, but JaCoP has the speed of the highly optimized JVM behind it. Let&#8217;s see who comes out on top!</p>

<p><strong>Disclaimer:</strong> I acknowledge that benchmarking is an easy thing to do incorrectly. I&#8217;ve made the <a href='https://github.com/nickknw/constraint-programming-benchmarks'>source code for these benchmarks</a> available on github and included instructions to allow you to (hopefully!) easily replicate my results. Please feel free to double check what I&#8217;ve done, I am more than happy to receive feedback telling me I am wrong. Contributions using other libraries or languages are also welcome.</p>

<p><strong>Results:</strong></p>

<p>SWI-Prolog managed to solve the sample sudoku problem in an average of <strong>78 milliseconds</strong> on my machine.</p>

<p>JaCoP managed to solve the sample sudoku problem in an average of <strong>95 milliseconds</strong> on my machine.</p>

<p>The Scala version takes <strong>1.2 times</strong> longer to run than the Prolog version. Honestly, this was an unexpected result for me; I would have guessed JaCoP had the edge. Regardless, they are both <em>pretty damn fast</em> solutions for not a lot of effort. Both win here.</p>
<h4>Conclusions</h4>
<p>Given the close results, there is only one clear conclusion I can draw from this comparison: Scala + JaCoP can roughly match the expressiveness and speed of a Prolog solution, at least for Sudoku. But that&#8217;s boring! If I may hypothesize, I would guess that: for a large class of problems, constraint programming libraries can give you most of the benefits of a logic programming solution while only sacrificing a little bit of declarative conciseness and elegance.</p>

<p>Good news for the working programmer who doesn&#8217;t feel he has time to learn Prolog!</p>
<h4>More constraint programming examples</h4>
<p>Hakan Kjellerstrand has a <a href='http://www.hakank.org/constraint_programming/'>fantastic collection of problems</a> solved using many different constraint programming libraries. It is a great resource and can be fun to compare different implementations of the same problem.</p>

<h2 id='full_code_listing'>Full Code Listing</h2>

<p>Here is a nicely formatted version of my solutions to the exercises from Day 3 of Prolog. The home of the following code is <a href='https://github.com/nickknw/seven-languages-in-seven-weeks/blob/master/week-3-prolog/day3.pl'>on github</a> with the other exercises.</p>
<div id='formatted_solutions'>

<h3>Find:</h3>

<div class='question'><b>1.</b> Prolog has some input/output features as well. Find print predicates that print out variables.</div>

<div class='code_explanation'>
There's 'write'. I'll paste my minInList function in here and make it
write each element of the list while it checks them.
Aha, 'format' and 'writef' are very nice too.
</div>


<div class='highlight'><pre><code class='prolog'><span class='nf'>min</span><span class='p'>(</span><span class='nv'>A</span><span class='p'>,</span><span class='nv'>A</span><span class='p'>,</span><span class='nv'>A</span><span class='p'>).</span>
<span class='nf'>min</span><span class='p'>(</span><span class='nv'>A</span><span class='p'>,</span><span class='nv'>B</span><span class='p'>,</span><span class='nv'>B</span><span class='p'>)</span> <span class='p'>:-</span> <span class='nv'>B</span> <span class='o'>&lt;</span> <span class='nv'>A</span><span class='p'>.</span>
<span class='nf'>min</span><span class='p'>(</span><span class='nv'>A</span><span class='p'>,</span><span class='nv'>B</span><span class='p'>,</span><span class='nv'>A</span><span class='p'>)</span> <span class='p'>:-</span> <span class='nv'>A</span> <span class='o'>&lt;</span> <span class='nv'>B</span><span class='p'>.</span>

<span class='nf'>minInList</span><span class='p'>([</span><span class='nv'>X</span><span class='p'>|</span><span class='nv'>XS</span><span class='p'>],</span> <span class='nv'>M</span><span class='p'>)</span> <span class='p'>:-</span> <span class='nf'>minInList</span><span class='p'>(</span><span class='nv'>XS</span><span class='p'>,</span> <span class='nv'>M1</span><span class='p'>),</span> <span class='nf'>min</span><span class='p'>(</span><span class='nv'>X</span><span class='p'>,</span> <span class='nv'>M1</span><span class='p'>,</span> <span class='nv'>M</span><span class='p'>),</span> <span class='nf'>format</span><span class='p'>(</span><span class='s-Atom'>&#39;~a, &#39;</span><span class='p'>,</span> <span class='nv'>X</span><span class='p'>).</span>
<span class='nf'>minInList</span><span class='p'>([</span><span class='nv'>X</span><span class='p'>],</span> <span class='nv'>X</span><span class='p'>)</span> <span class='p'>:-</span> <span class='nf'>format</span><span class='p'>(</span><span class='s-Atom'>&#39;~a, &#39;</span><span class='p'>,</span> <span class='nv'>X</span><span class='p'>).</span>
</code></pre>
</div>



<div class='question'><b>2.</b> Find a way to use the print predicates to print only successful solutions. How do they work?</div>

<div class='code_explanation'>
To answer this one... I guess I want to use a rule that can have multiple
correct answers. I'll take an example from the book.
</div>


<div class='highlight'><pre><code class='prolog'><span class='nf'>different</span><span class='p'>(</span><span class='s-Atom'>red</span><span class='p'>,</span> <span class='s-Atom'>green</span><span class='p'>).</span> <span class='nf'>different</span><span class='p'>(</span><span class='s-Atom'>red</span><span class='p'>,</span> <span class='s-Atom'>blue</span><span class='p'>).</span>
<span class='nf'>different</span><span class='p'>(</span><span class='s-Atom'>green</span><span class='p'>,</span> <span class='s-Atom'>red</span><span class='p'>).</span> <span class='nf'>different</span><span class='p'>(</span><span class='s-Atom'>green</span><span class='p'>,</span> <span class='s-Atom'>blue</span><span class='p'>).</span>
<span class='nf'>different</span><span class='p'>(</span><span class='s-Atom'>blue</span><span class='p'>,</span> <span class='s-Atom'>red</span><span class='p'>).</span> <span class='nf'>different</span><span class='p'>(</span><span class='s-Atom'>blue</span><span class='p'>,</span> <span class='s-Atom'>green</span><span class='p'>).</span>

<span class='nf'>coloring</span><span class='p'>(</span><span class='nv'>Alabama</span><span class='p'>,</span> <span class='nv'>Mississippi</span><span class='p'>,</span> <span class='nv'>Georgia</span><span class='p'>,</span> <span class='nv'>Tennessee</span><span class='p'>,</span> <span class='nv'>Florida</span><span class='p'>)</span> <span class='p'>:-</span>
    <span class='nf'>different</span><span class='p'>(</span><span class='nv'>Mississippi</span><span class='p'>,</span> <span class='nv'>Tennessee</span><span class='p'>),</span>
    <span class='nf'>different</span><span class='p'>(</span><span class='nv'>Mississippi</span><span class='p'>,</span> <span class='nv'>Alabama</span><span class='p'>),</span>
    <span class='nf'>different</span><span class='p'>(</span><span class='nv'>Alabama</span><span class='p'>,</span> <span class='nv'>Tennessee</span><span class='p'>),</span>
    <span class='nf'>different</span><span class='p'>(</span><span class='nv'>Alabama</span><span class='p'>,</span> <span class='nv'>Mississippi</span><span class='p'>),</span>
    <span class='nf'>different</span><span class='p'>(</span><span class='nv'>Alabama</span><span class='p'>,</span> <span class='nv'>Georgia</span><span class='p'>),</span>
    <span class='nf'>different</span><span class='p'>(</span><span class='nv'>Alabama</span><span class='p'>,</span> <span class='nv'>Florida</span><span class='p'>),</span>
    <span class='nf'>different</span><span class='p'>(</span><span class='nv'>Georgia</span><span class='p'>,</span> <span class='nv'>Florida</span><span class='p'>),</span>
    <span class='nf'>different</span><span class='p'>(</span><span class='nv'>Georgia</span><span class='p'>,</span> <span class='nv'>Tennessee</span><span class='p'>),</span>
    <span class='nf'>format</span><span class='p'>(</span><span class='s-Atom'>&#39;~a, ~a, ~a, ~a, ~a&#39;</span><span class='p'>,</span> <span class='p'>[</span><span class='nv'>Alabama</span><span class='p'>,</span> <span class='nv'>Mississippi</span><span class='p'>,</span> <span class='nv'>Georgia</span><span class='p'>,</span> <span class='nv'>Tennessee</span><span class='p'>,</span> <span class='nv'>Florida</span><span class='p'>]).</span>
</code></pre>
</div>



<div class='code_explanation'>
Well, that will only print successful solutions, but I kind of feel like I've
missed the point. All this will do is repeat the information that you already
receive. Oh well, if I figure it out I'll come back to it.
</div>


<h3>Do:</h3>

<div class='question'><b>1.</b> Modify the Sudoku solver to work on six-by-six puzzles (squares are 3x2) and 9x9 puzzles)</div>

<div class='code_explanation'>
I wrote a long awful version of this first, then cheated to write a better one.
I looked at <a href='http://stackoverflow.com/questions/1768274/prolog-learning-by-example'>this sudoku solver</a> (found in the <a href='http://www.swi-prolog.org/man/clpfd.html'>clp(fd) documentation</a>), understood how it worked, then closed it and wrote my own. This is the version that you see below. I also chose to do just 9x9.
</div>


<div class='highlight'><pre><code class='prolog'><span class='p'>:-</span> <span class='nf'>use_module</span><span class='p'>(</span><span class='nf'>library</span><span class='p'>(</span><span class='s-Atom'>clpfd</span><span class='p'>)).</span>

<span class='nf'>sudoku</span><span class='p'>(</span><span class='nv'>Rows</span><span class='p'>)</span> <span class='p'>:-</span>
    <span class='c1'>% split into rows</span>
    <span class='nv'>Rows</span> <span class='o'>=</span> <span class='p'>[</span><span class='nv'>A</span><span class='p'>,</span> <span class='nv'>B</span><span class='p'>,</span> <span class='nv'>C</span><span class='p'>,</span> <span class='nv'>D</span><span class='p'>,</span> <span class='nv'>E</span><span class='p'>,</span> <span class='nv'>F</span><span class='p'>,</span> <span class='nv'>G</span><span class='p'>,</span> <span class='nv'>H</span><span class='p'>,</span> <span class='nv'>I</span><span class='p'>],</span>
    <span class='c1'>% and columns</span>
    <span class='nf'>transpose</span><span class='p'>(</span><span class='nv'>Rows</span><span class='p'>,</span> <span class='nv'>Columns</span><span class='p'>),</span> 

    <span class='c1'>% some bounds checking</span>
    <span class='nf'>append</span><span class='p'>(</span><span class='nv'>Rows</span><span class='p'>,</span> <span class='nv'>FlattenedRows</span><span class='p'>),</span> <span class='nv'>FlattenedRows</span> <span class='s-Atom'>ins</span> <span class='m'>1</span><span class='p'>..</span><span class='m'>9</span><span class='p'>,</span>
    <span class='nf'>length</span><span class='p'>(</span><span class='nv'>Rows</span><span class='p'>,</span> <span class='m'>9</span><span class='p'>),</span>
    <span class='nf'>length</span><span class='p'>(</span><span class='nv'>Columns</span><span class='p'>,</span> <span class='m'>9</span><span class='p'>),</span>

    <span class='c1'>% all rows valid</span>
    <span class='nf'>maplist</span><span class='p'>(</span><span class='s-Atom'>all_distinct</span><span class='p'>,</span> <span class='nv'>Rows</span><span class='p'>),</span>

    <span class='c1'>% all columns valid</span>
    <span class='nf'>maplist</span><span class='p'>(</span><span class='s-Atom'>all_distinct</span><span class='p'>,</span> <span class='nv'>Columns</span><span class='p'>),</span>

    <span class='c1'>% all blocks valid</span>
    <span class='nf'>valid_blocks</span><span class='p'>(</span><span class='nv'>A</span><span class='p'>,</span> <span class='nv'>B</span><span class='p'>,</span> <span class='nv'>C</span><span class='p'>),</span>
    <span class='nf'>valid_blocks</span><span class='p'>(</span><span class='nv'>D</span><span class='p'>,</span> <span class='nv'>E</span><span class='p'>,</span> <span class='nv'>F</span><span class='p'>),</span>
    <span class='nf'>valid_blocks</span><span class='p'>(</span><span class='nv'>G</span><span class='p'>,</span> <span class='nv'>H</span><span class='p'>,</span> <span class='nv'>I</span><span class='p'>),</span>

    <span class='nf'>prettier_print</span><span class='p'>(</span><span class='nv'>FlattenedRows</span><span class='p'>).</span>

<span class='nf'>valid_blocks</span><span class='p'>([],</span> <span class='p'>[],</span> <span class='p'>[]).</span>  
<span class='nf'>valid_blocks</span><span class='p'>([</span><span class='nv'>A1</span><span class='p'>,</span> <span class='nv'>A2</span><span class='p'>,</span> <span class='nv'>A3</span> <span class='p'>|</span> <span class='nv'>As</span><span class='p'>],</span> <span class='p'>[</span><span class='nv'>B1</span><span class='p'>,</span> <span class='nv'>B2</span><span class='p'>,</span> <span class='nv'>B3</span> <span class='p'>|</span> <span class='nv'>Bs</span><span class='p'>],</span> <span class='p'>[</span><span class='nv'>C1</span><span class='p'>,</span> <span class='nv'>C2</span><span class='p'>,</span> <span class='nv'>C3</span> <span class='p'>|</span> <span class='nv'>Cs</span><span class='p'>])</span> <span class='p'>:-</span>
    <span class='nf'>maplist</span><span class='p'>(</span><span class='s-Atom'>all_distinct</span><span class='p'>,</span> <span class='p'>[</span><span class='nv'>A1</span><span class='p'>,</span> <span class='nv'>A2</span><span class='p'>,</span> <span class='nv'>A3</span><span class='p'>,</span> <span class='nv'>B1</span><span class='p'>,</span> <span class='nv'>B2</span><span class='p'>,</span> <span class='nv'>B3</span><span class='p'>,</span> <span class='nv'>C1</span><span class='p'>,</span> <span class='nv'>C2</span><span class='p'>,</span> <span class='nv'>C3</span><span class='p'>]),</span>
    <span class='nf'>valid_blocks</span><span class='p'>(</span><span class='nv'>As</span><span class='p'>,</span> <span class='nv'>Bs</span><span class='p'>,</span> <span class='nv'>Cs</span><span class='p'>).</span>


<span class='nf'>problem</span><span class='p'>(</span><span class='m'>1</span><span class='p'>,</span> <span class='p'>[[</span><span class='k'>_</span><span class='p'>,</span><span class='k'>_</span><span class='p'>,</span><span class='k'>_</span><span class='p'>,</span><span class='k'>_</span><span class='p'>,</span><span class='k'>_</span><span class='p'>,</span><span class='k'>_</span><span class='p'>,</span><span class='k'>_</span><span class='p'>,</span><span class='k'>_</span><span class='p'>,</span><span class='k'>_</span><span class='p'>],</span>                                   
            <span class='p'>[</span><span class='k'>_</span><span class='p'>,</span><span class='k'>_</span><span class='p'>,</span><span class='k'>_</span><span class='p'>,</span><span class='k'>_</span><span class='p'>,</span><span class='k'>_</span><span class='p'>,</span><span class='m'>3</span><span class='p'>,</span><span class='k'>_</span><span class='p'>,</span><span class='m'>8</span><span class='p'>,</span><span class='m'>5</span><span class='p'>],</span>                                   
            <span class='p'>[</span><span class='k'>_</span><span class='p'>,</span><span class='k'>_</span><span class='p'>,</span><span class='m'>1</span><span class='p'>,</span><span class='k'>_</span><span class='p'>,</span><span class='m'>2</span><span class='p'>,</span><span class='k'>_</span><span class='p'>,</span><span class='k'>_</span><span class='p'>,</span><span class='k'>_</span><span class='p'>,</span><span class='k'>_</span><span class='p'>],</span>                                   
            <span class='p'>[</span><span class='k'>_</span><span class='p'>,</span><span class='k'>_</span><span class='p'>,</span><span class='k'>_</span><span class='p'>,</span><span class='m'>5</span><span class='p'>,</span><span class='k'>_</span><span class='p'>,</span><span class='m'>7</span><span class='p'>,</span><span class='k'>_</span><span class='p'>,</span><span class='k'>_</span><span class='p'>,</span><span class='k'>_</span><span class='p'>],</span>                                   
            <span class='p'>[</span><span class='k'>_</span><span class='p'>,</span><span class='k'>_</span><span class='p'>,</span><span class='m'>4</span><span class='p'>,</span><span class='k'>_</span><span class='p'>,</span><span class='k'>_</span><span class='p'>,</span><span class='k'>_</span><span class='p'>,</span><span class='m'>1</span><span class='p'>,</span><span class='k'>_</span><span class='p'>,</span><span class='k'>_</span><span class='p'>],</span>                                   
            <span class='p'>[</span><span class='k'>_</span><span class='p'>,</span><span class='m'>9</span><span class='p'>,</span><span class='k'>_</span><span class='p'>,</span><span class='k'>_</span><span class='p'>,</span><span class='k'>_</span><span class='p'>,</span><span class='k'>_</span><span class='p'>,</span><span class='k'>_</span><span class='p'>,</span><span class='k'>_</span><span class='p'>,</span><span class='k'>_</span><span class='p'>],</span>                                  
            <span class='p'>[</span><span class='m'>5</span><span class='p'>,</span><span class='k'>_</span><span class='p'>,</span><span class='k'>_</span><span class='p'>,</span><span class='k'>_</span><span class='p'>,</span><span class='k'>_</span><span class='p'>,</span><span class='k'>_</span><span class='p'>,</span><span class='k'>_</span><span class='p'>,</span><span class='m'>7</span><span class='p'>,</span><span class='m'>3</span><span class='p'>],</span>                                  
            <span class='p'>[</span><span class='k'>_</span><span class='p'>,</span><span class='k'>_</span><span class='p'>,</span><span class='m'>2</span><span class='p'>,</span><span class='k'>_</span><span class='p'>,</span><span class='m'>1</span><span class='p'>,</span><span class='k'>_</span><span class='p'>,</span><span class='k'>_</span><span class='p'>,</span><span class='k'>_</span><span class='p'>,</span><span class='k'>_</span><span class='p'>],</span>                                   
            <span class='p'>[</span><span class='k'>_</span><span class='p'>,</span><span class='k'>_</span><span class='p'>,</span><span class='k'>_</span><span class='p'>,</span><span class='k'>_</span><span class='p'>,</span><span class='m'>4</span><span class='p'>,</span><span class='k'>_</span><span class='p'>,</span><span class='k'>_</span><span class='p'>,</span><span class='k'>_</span><span class='p'>,</span><span class='m'>9</span><span class='p'>]]).</span>

<span class='c1'>% can test with:</span>
<span class='c1'>% ?- problem(1, Board), sudoku(Board).</span>
</code></pre>
</div>



<div class='question'><b>2.</b> Make the Sudoku solver print prettier
solutions.</div>


<div class='highlight'><pre><code class='prolog'><span class='nf'>prettier_print</span><span class='p'>([]).</span>
<span class='nf'>prettier_print</span><span class='p'>(</span><span class='nv'>Puzzle</span><span class='p'>)</span> <span class='p'>:-</span> <span class='nf'>prettier_print</span><span class='p'>(</span><span class='m'>0</span><span class='p'>,</span> <span class='nv'>Puzzle</span><span class='p'>).</span>

<span class='nf'>prettier_print</span><span class='p'>(</span><span class='m'>0</span><span class='p'>,</span> <span class='nv'>Puzzle</span><span class='p'>)</span> <span class='p'>:-</span> 
    <span class='nf'>writeln</span><span class='p'>(</span><span class='s-Atom'>&#39;┌───────┬───────┬───────┐&#39;</span><span class='p'>),</span> 
    <span class='nf'>prettier_print</span><span class='p'>(</span><span class='m'>1</span><span class='p'>,</span> <span class='nv'>Puzzle</span><span class='p'>).</span>
<span class='nf'>prettier_print</span><span class='p'>(</span><span class='m'>4</span><span class='p'>,</span> <span class='nv'>Puzzle</span><span class='p'>)</span> <span class='p'>:-</span> 
    <span class='nf'>writeln</span><span class='p'>(</span><span class='s-Atom'>&#39;│───────┼───────┼───────│&#39;</span><span class='p'>),</span> 
    <span class='nf'>prettier_print</span><span class='p'>(</span><span class='m'>5</span><span class='p'>,</span> <span class='nv'>Puzzle</span><span class='p'>).</span>
<span class='nf'>prettier_print</span><span class='p'>(</span><span class='m'>8</span><span class='p'>,</span> <span class='nv'>Puzzle</span><span class='p'>)</span> <span class='p'>:-</span> 
    <span class='nf'>writeln</span><span class='p'>(</span><span class='s-Atom'>&#39;│───────┼───────┼───────│&#39;</span><span class='p'>),</span> 
    <span class='nf'>prettier_print</span><span class='p'>(</span><span class='m'>9</span><span class='p'>,</span> <span class='nv'>Puzzle</span><span class='p'>).</span>
<span class='nf'>prettier_print</span><span class='p'>(</span><span class='m'>12</span><span class='p'>,</span> <span class='p'>[])</span> <span class='p'>:-</span> 
    <span class='nf'>writeln</span><span class='p'>(</span><span class='s-Atom'>&#39;└───────┴───────┴───────┘&#39;</span><span class='p'>).</span>

<span class='nf'>prettier_print</span><span class='p'>(</span><span class='nv'>N</span><span class='p'>,</span> <span class='p'>[</span><span class='nv'>Col1</span><span class='p'>,</span> <span class='nv'>Col2</span><span class='p'>,</span> <span class='nv'>Col3</span><span class='p'>,</span> <span class='nv'>Col4</span><span class='p'>,</span> <span class='nv'>Col5</span><span class='p'>,</span> <span class='nv'>Col6</span><span class='p'>,</span> <span class='nv'>Col7</span><span class='p'>,</span> <span class='nv'>Col8</span><span class='p'>,</span> <span class='nv'>Col9</span> <span class='p'>|</span> <span class='nv'>Puzzle</span><span class='p'>])</span> <span class='p'>:-</span> 
    <span class='nf'>member</span><span class='p'>(</span><span class='nv'>N</span><span class='p'>,</span> <span class='p'>[</span><span class='m'>1</span><span class='p'>,</span><span class='m'>2</span><span class='p'>,</span><span class='m'>3</span><span class='p'>,</span><span class='m'>5</span><span class='p'>,</span><span class='m'>6</span><span class='p'>,</span><span class='m'>7</span><span class='p'>,</span><span class='m'>9</span><span class='p'>,</span><span class='m'>10</span><span class='p'>,</span><span class='m'>11</span><span class='p'>]),</span>
    <span class='c1'>%N =\= 0, N =\= 4, N =\= 8, N =\= 13,</span>
    <span class='c1'>% note to self about above: remember, prolog&#39;s pattern matching isn&#39;t</span>
    <span class='c1'>% like pattern matching in other languages</span>

    <span class='nf'>format</span><span class='p'>(</span><span class='s-Atom'>&#39;│ ~d ~d ~d │ ~d ~d ~d │ ~d ~d ~d │~n&#39;</span><span class='p'>,</span> <span class='p'>[</span><span class='nv'>Col1</span><span class='p'>,</span> <span class='nv'>Col2</span><span class='p'>,</span> <span class='nv'>Col3</span><span class='p'>,</span> <span class='nv'>Col4</span><span class='p'>,</span> <span class='nv'>Col5</span><span class='p'>,</span> <span class='nv'>Col6</span><span class='p'>,</span> <span class='nv'>Col7</span><span class='p'>,</span> <span class='nv'>Col8</span><span class='p'>,</span> <span class='nv'>Col9</span><span class='p'>]),</span> 
    <span class='nf'>succ</span><span class='p'>(</span><span class='nv'>N</span><span class='p'>,</span> <span class='nv'>N1</span><span class='p'>),</span>
    <span class='nf'>prettier_print</span><span class='p'>(</span><span class='nv'>N1</span><span class='p'>,</span> <span class='nv'>Puzzle</span><span class='p'>).</span>
</code></pre>
</div>



<div class='tiny_title'>Output</div>

<div class='symmetrical_line_height'>

<div class='highlight'><pre><code class='bash'>?- problem<span class='o'>(</span>1, Board<span class='o'>)</span>, sudoku<span class='o'>(</span>Board<span class='o'>)</span>.

┌───────┬───────┬───────┐
│ 9 8 7 │ 6 5 4 │ 3 2 1 │
│ 2 4 6 │ 1 7 3 │ 9 8 5 │
│ 3 5 1 │ 9 2 8 │ 7 4 6 │
│───────┼───────┼───────│
│ 1 2 8 │ 5 3 7 │ 6 9 4 │
│ 6 3 4 │ 8 9 2 │ 1 5 7 │
│ 7 9 5 │ 4 6 1 │ 8 3 2 │
│───────┼───────┼───────│
│ 5 1 9 │ 2 8 6 │ 4 7 3 │
│ 4 7 2 │ 3 1 9 │ 5 6 8 │
│ 8 6 3 │ 7 4 5 │ 2 1 9 │
└───────┴───────┴───────┘
</code></pre>
</div>


</div>

<div class='question'><b>3.</b> Solve the Eight Queens problem by taking a list of queens. Rather than a
tuple, represent each queen with an integer, from 1-8. Get the row of a queen
by its position in the list and the column by the value in the list.
</div>

<div class='code_explanation'>...I think I'm just going to leave this one. I'd
like to move on to Scala at this point</div>

</div>
<p>Next in this series: Day 1 of Scala (coming soon)</p>
  </div>

  <div style="margin-top:20px; font-size:14px;">
    <a href="/blog/2012/08/06/seven-languages-week-3-day-3/#disqus_thread" data-disqus-identifier="/blog/2012/08/06/seven-languages-week-3-day-3">Comments</a>
  </div>

    <hr class="fancyrule" />

  <div>
  <h1 style="margin:0px"><a href="/blog/2012/07/17/seven-languages-week-3-day-2/">
  Seven Languages: Week 3 (Prolog) - Day 2
  </a></h1>
  <div class="faded" style="font-size:14px; margin-bottom:5px;">17 Jul 2012</div>
  <p>Day 2 of Prolog really emphasized its declarative aspects for me. Writing Prolog well <em>requires</em> you to think differently about the way you approach the problem. Yes, given enough time you can hack something together (I&#8217;ve sure proven that!), but you can get a lot more out of it by learning to structure your thoughts to fit the way Prolog works. All languages are like this to some extent, and this isn&#8217;t a bad thing. The difference is in degree - existing imperative and functional programming thought patterns help a lot less in Prolog.</p>

<p>So what, in short, makes it so different? Putting aside my impulse to immediately whip out some code samples, I think characterizing it like this is an accurate enough high level summary for now:</p>
<ul class='compact_list'>
<li><b>Imperative programming:</b> you state what steps you want the machine to perform</li>
<li><b>Functional programming:</b> you state what operations you want to apply to some data</li>
<li><b>Logic programming:</b> you state what goals will make this rule true</li>
</ul>
<p>Like my other experiences so far with Prolog, Day 2 was a mix of &#8220;this is brilliant!&#8221; and &#8220;this is incredibly frustrating&#8221;. It is possible to do some really cool things with Prolog (and other logic languages like Curry, Mercury, and Oz. Also Datalog and constraint solving libraries, which I am covering in Day 3), but it has some decently sized stumbling blocks as well:</p>

<p><strong>Documentation</strong>:</p>

<ul>
<li>
<p>Resources for someone learning Prolog are sparse, even compared to a very new language like Io. When looking for documentation you can quickly find yourself reading academic papers. While these are interesting they are not especially useful when I just want to know more about list syntax or how to use higher order functions.</p>
</li>

<li>
<p>As an aside, it turns out Prolog does in fact have <a href='http://www.j-paine.org/dobbs/ho_span_count.html'>higher order function</a> equivalents (or should I say higher order rules?). I didn&#8217;t actually know about this until I came back to write this post after doing the exercises .</p>
</li>
</ul>

<p><strong>Troubleshooting</strong>:</p>

<ul>
<li>
<p>You have an almost absolute lack of help when something goes wrong with your Prolog program.</p>
</li>

<li>
<p>Many syntax errors don&#8217;t give you much information as to what you&#8217;ve phrased incorrectly, leaving you to go back to your program and try tweaking things that look off. For someone who has already internalized the syntax I am sure this isn&#8217;t an issue, but for people still learning it can be quite frustrating. One example of something that gave me a hard time was <code>ERROR: Arguments are not sufficiently instantiated</code>. That cryptic message is literally the only information you get: no line numbers, rule names, or any other hints.</p>
</li>

<li>
<p>More serious than syntax is trying to fix logical errors. It was common for me to have a program with some small flaw and just get back <code>false.</code> when attempting to run it. It is hard to pick apart exactly what went wrong. Prolog is a <a href='http://www.j-paine.org/dobbs/prolog_lightbulb.html'>little bit famous for this</a>.</p>
</li>
</ul>

<p><strong>Recursion</strong> used to be on this list, but most of the issues I had turned out to really be a lack of knowledge on my part. It <em>was</em> difficult for me to acquire that knowledge though, so I am going to document the parts that gave me the most trouble here in hopes I can save some future programmer a bit of time.</p>
<div class='interjection'><p>
(This article is part of a series of posts I am doing about my journey through the exercises of the book <a href='http://pragprog.com/book/btlang/seven-languages-in-seven-weeks'>Seven Languages In Seven Weeks</a>. The article previous to this one is <a href='/blog/2012/02/05/seven-languages-week-3-day-1/'>Week 3 (Prolog) - Day 1</a>. For an overview see the <a href='/projects/seven-languages-in-seven-weeks/'>project page</a>.)
</p></div>
<h2 id='topics_covered'>Topics covered</h2>

<p>Day 2 of Prolog went over lists, unification, and recursion.</p>

<p>I am going to write about these topics with a focus on the problems I encountered while trying to write solutions to the exercises (and another simple program that calculated <a href='http://en.wikipedia.org/wiki/Combination'>combinations</a>).</p>
<h3>Lists</h3>
<p>Most of the trouble I had with lists was centered around the cons syntax for lists that is so useful in pattern matching. In Haskell, this looks like <code>(x:xs)</code>, <code>(x:y:tail)</code>, or even <code>(x:y:z:[])</code>. When I first learned this syntax in Prolog I didn&#8217;t have enough examples to form a correct mental model of the way it worked.</p>

<p>So, here are bunch of valid examples of constructing lists.</p>

<p>Basic examples:</p>
<div class='highlight'><pre><code class='prolog'><span class='p'>[</span><span class='nv'>X</span><span class='p'>,</span> <span class='nv'>Y</span><span class='p'>,</span> <span class='nv'>Z</span><span class='p'>]</span>           <span class='c1'>% normal list syntax - list of three elements</span>

<span class='p'>[</span><span class='nv'>X</span><span class='p'>|</span><span class='nv'>Xs</span><span class='p'>]</span>              <span class='c1'>% basic use of cons operator - divide list into head (X) and tail (Xs)</span>

<span class='p'>[</span><span class='nv'>X</span><span class='p'>|[]]</span>              <span class='c1'>% appending an empty list to a single item gives you a list with one element</span>
<span class='p'>[</span><span class='nv'>X</span><span class='p'>]</span>                 <span class='c1'>% a shorter way to express having a list with a single element</span>

<span class='p'>[</span><span class='nv'>X</span><span class='p'>,</span> <span class='nv'>Y</span><span class='p'>]</span>              <span class='c1'>% list with two and only two elements - regular syntax</span>
<span class='p'>[</span><span class='nv'>X</span><span class='p'>|[</span><span class='nv'>Y</span><span class='p'>|[]]]</span>          <span class='c1'>% same - using full cons syntax</span>
<span class='p'>[</span><span class='nv'>X</span><span class='p'>|[</span><span class='nv'>Y</span><span class='p'>]]</span>             <span class='c1'>% same - without the unnecessary empty list concatenation</span>

<span class='p'>[</span><span class='nv'>X</span><span class='p'>,</span> <span class='nv'>Y</span><span class='p'>,</span> <span class='nv'>Z</span><span class='p'>]</span>           <span class='c1'>% list with three and only three elements - regular syntax</span>
<span class='p'>[</span><span class='nv'>X</span><span class='p'>|[</span><span class='nv'>Y</span><span class='p'>|[</span><span class='nv'>Z</span><span class='p'>]]]</span>         <span class='c1'>% same - using cons syntax</span>
<span class='p'>[</span><span class='nv'>X</span><span class='p'>,</span> <span class='nv'>Y</span><span class='p'>|[</span><span class='nv'>Z</span><span class='p'>]]</span>          <span class='c1'>% same - using simplified cons syntax</span>
</code></pre>
</div>
<p>But it doesn&#8217;t make sense to use cons syntax to do what regular list syntax already expresses better. Here are some more interesting examples that make use of the strengths of cons syntax:</p>
<div class='highlight'><pre><code class='prolog'><span class='p'>[</span><span class='nv'>X</span><span class='p'>|[</span><span class='nv'>Y</span><span class='p'>|</span><span class='nv'>Ys</span><span class='p'>]]</span>        <span class='c1'>% list with at least two elements (X and Y), bind the rest of the list to Ys</span>
<span class='p'>[</span><span class='nv'>X</span><span class='p'>,</span> <span class='nv'>Y</span><span class='p'>|</span><span class='nv'>Ys</span><span class='p'>]</span>         <span class='c1'>% same - using simplified cons syntax</span>

<span class='p'>[</span><span class='k'>_</span><span class='p'>|[</span><span class='k'>_</span><span class='p'>|</span><span class='nv'>Tail</span><span class='p'>]]</span>      <span class='c1'>% list with at least two elements, don&#39;t bind names to first two elements, bind the rest to Tail</span>
<span class='p'>[</span><span class='k'>_</span><span class='p'>,</span> <span class='k'>_</span><span class='p'>|</span><span class='nv'>Tail</span><span class='p'>]</span>       <span class='c1'>% same - using simplified cons syntax</span>

<span class='p'>[</span><span class='nv'>X</span><span class='p'>|[</span><span class='nv'>Y</span><span class='p'>|[</span><span class='nv'>Z</span><span class='p'>|</span><span class='k'>_</span><span class='p'>]]]</span>     <span class='c1'>% list with at least three elements, discard the tail</span>
<span class='p'>[</span><span class='nv'>X</span><span class='p'>,</span> <span class='nv'>Y</span><span class='p'>,</span> <span class='nv'>Z</span><span class='p'>|</span><span class='k'>_</span><span class='p'>]</span>       <span class='c1'>% same - using simplified cons syntax</span>
</code></pre>
</div>
<p>To cement these, here are some concrete examples of pattern matching with lists:</p>
<div class='highlight'><pre><code class='prolog'><span class='s-Atom'>?-</span> <span class='p'>[</span><span class='s-Atom'>a</span><span class='p'>,</span> <span class='s-Atom'>b</span><span class='p'>,</span> <span class='s-Atom'>c</span><span class='p'>,</span> <span class='s-Atom'>d</span><span class='p'>]</span> <span class='o'>=</span> <span class='p'>[</span><span class='nv'>X</span><span class='p'>|</span><span class='nv'>Xs</span><span class='p'>].</span>           <span class='c1'>% X = a, Xs = [b, c, d].</span>
<span class='s-Atom'>?-</span> <span class='p'>[</span><span class='s-Atom'>a</span><span class='p'>,</span> <span class='s-Atom'>b</span><span class='p'>,</span> <span class='s-Atom'>c</span><span class='p'>,</span> <span class='s-Atom'>d</span><span class='p'>]</span> <span class='o'>=</span> <span class='p'>[</span><span class='nv'>X</span><span class='p'>|</span><span class='k'>_</span><span class='p'>].</span>            <span class='c1'>% X = a.</span>
<span class='s-Atom'>?-</span> <span class='p'>[</span><span class='s-Atom'>a</span><span class='p'>,</span> <span class='s-Atom'>b</span><span class='p'>,</span> <span class='s-Atom'>c</span><span class='p'>,</span> <span class='s-Atom'>d</span><span class='p'>]</span> <span class='o'>=</span> <span class='p'>[</span><span class='k'>_</span><span class='p'>|</span><span class='nv'>Xs</span><span class='p'>].</span>           <span class='c1'>% Xs = [b, c, d].</span>

<span class='s-Atom'>?-</span> <span class='p'>[</span><span class='s-Atom'>a</span><span class='p'>,</span> <span class='s-Atom'>b</span><span class='p'>,</span> <span class='s-Atom'>c</span><span class='p'>,</span> <span class='s-Atom'>d</span><span class='p'>]</span> <span class='o'>=</span> <span class='p'>[</span><span class='nv'>W</span><span class='p'>,</span> <span class='nv'>X</span><span class='p'>,</span> <span class='nv'>Y</span><span class='p'>,</span> <span class='nv'>Z</span><span class='p'>].</span>     <span class='c1'>% W = a, X = b, Y = c, Z = d. </span>
<span class='s-Atom'>?-</span> <span class='p'>[</span><span class='s-Atom'>a</span><span class='p'>,</span> <span class='s-Atom'>b</span><span class='p'>,</span> <span class='s-Atom'>c</span><span class='p'>,</span> <span class='s-Atom'>d</span><span class='p'>]</span> <span class='o'>=</span> <span class='p'>[</span><span class='nv'>W</span><span class='p'>|[</span><span class='nv'>X</span><span class='p'>|[</span><span class='nv'>Y</span><span class='p'>|[</span><span class='nv'>Z</span><span class='p'>]]].</span>   <span class='c1'>% W = a, X = b, Y = c, Z = d. </span>

<span class='s-Atom'>?-</span> <span class='p'>[</span><span class='s-Atom'>a</span><span class='p'>,</span> <span class='s-Atom'>b</span><span class='p'>,</span> <span class='s-Atom'>c</span><span class='p'>,</span> <span class='s-Atom'>d</span><span class='p'>]</span> <span class='o'>=</span> <span class='p'>[</span><span class='nv'>W</span><span class='p'>,</span> <span class='nv'>X</span><span class='p'>,</span> <span class='nv'>Y</span><span class='p'>].</span>        <span class='c1'>% false.</span>
<span class='s-Atom'>?-</span> <span class='p'>[</span><span class='s-Atom'>a</span><span class='p'>,</span> <span class='s-Atom'>b</span><span class='p'>,</span> <span class='s-Atom'>c</span><span class='p'>,</span> <span class='s-Atom'>d</span><span class='p'>]</span> <span class='o'>=</span> <span class='p'>[</span><span class='nv'>W</span><span class='p'>,</span> <span class='nv'>X</span><span class='p'>|</span><span class='nv'>Y</span><span class='p'>].</span>         <span class='c1'>% W = a, X = b, Y = [c, d].</span>

<span class='s-Atom'>?-</span> <span class='p'>[</span><span class='s-Atom'>a</span><span class='p'>,</span> <span class='s-Atom'>b</span><span class='p'>,</span> <span class='s-Atom'>c</span><span class='p'>,</span> <span class='s-Atom'>d</span><span class='p'>]</span> <span class='o'>=</span> <span class='p'>[</span><span class='nv'>W</span><span class='p'>,</span> <span class='nv'>X</span><span class='p'>|</span><span class='nv'>Y</span><span class='p'>].</span>         <span class='c1'>% W = a, X = b, Y = [c, d]. </span>
<span class='s-Atom'>?-</span> <span class='p'>[</span><span class='s-Atom'>a</span><span class='p'>,</span> <span class='s-Atom'>b</span><span class='p'>,</span> <span class='s-Atom'>c</span><span class='p'>,</span> <span class='s-Atom'>d</span><span class='p'>]</span> <span class='o'>=</span> <span class='p'>[</span><span class='k'>_</span><span class='p'>,</span> <span class='nv'>X</span><span class='p'>|</span><span class='nv'>Y</span><span class='p'>].</span>         <span class='c1'>% X = b, Y = [c, d].</span>
<span class='s-Atom'>?-</span> <span class='p'>[</span><span class='s-Atom'>a</span><span class='p'>,</span> <span class='s-Atom'>b</span><span class='p'>,</span> <span class='s-Atom'>c</span><span class='p'>,</span> <span class='s-Atom'>d</span><span class='p'>]</span> <span class='o'>=</span> <span class='p'>[</span><span class='nv'>W</span><span class='p'>,</span> <span class='k'>_</span><span class='p'>|</span><span class='nv'>Y</span><span class='p'>].</span>         <span class='c1'>% W = a, Y = [c, d].</span>
<span class='s-Atom'>?-</span> <span class='p'>[</span><span class='s-Atom'>a</span><span class='p'>,</span> <span class='s-Atom'>b</span><span class='p'>,</span> <span class='s-Atom'>c</span><span class='p'>,</span> <span class='s-Atom'>d</span><span class='p'>]</span> <span class='o'>=</span> <span class='p'>[</span><span class='nv'>W</span><span class='p'>,</span> <span class='nv'>X</span><span class='p'>|</span><span class='k'>_</span><span class='p'>].</span>         <span class='c1'>% W = a, X = b.</span>
</code></pre>
</div><h3>Unification</h3>
<p>Unification is one of Prolog&#8217;s fairly unique key features. A lot of the really neat things Prolog can do rely on unification to work (including that map colouring problem from <a href='/blog/2012/02/05/seven-languages-week-3-day-1/'>last week</a>). What is unificiation?</p>

<p>To quote <a href='http://en.wikipedia.org/wiki/Unification_(computer_science\'>from Wikipedia</a>):</p>

<blockquote>
<p>The goal of unification is to find a substitution which demonstrates that two seemingly different terms are in fact either identical or just equal.</p>
</blockquote>

<p>So what does that really mean? To demonstrate the difference unification makes I am going to show you the same function written in three different languages and three different styles. I&#8217;ve picked the <code>append</code> function (append one list to another list) which is a great example, even though it&#8217;s been explained many times before. In the comments on my <a href='/blog/2012/02/05/seven-languages-week-3-day-1/'>last post</a> actually, <a href='http://www.storytotell.org/'>Daniel Lyons</a> gave a <a href='/blog/2012/02/05/seven-languages-week-3-day-1/#comment-446662856'>nice demonstration</a> of <code>append</code> in Prolog, and it is an example <a href='http://www.java.net/external?url=http://blog.rapidred.com'>Bruce Tate</a> spends a couple pages on as well.</p>
<h4>Imperative (Javascript)</h4><div class='highlight'><pre><code class='javascript'><span class='kd'>function</span> <span class='nx'>append</span> <span class='p'>(</span><span class='nx'>xs</span><span class='p'>,</span> <span class='nx'>ys</span><span class='p'>)</span> <span class='p'>{</span>
    <span class='kd'>var</span> <span class='nx'>result</span> <span class='o'>=</span> <span class='nx'>xs</span><span class='p'>.</span><span class='nx'>slice</span><span class='p'>(</span><span class='mi'>0</span><span class='p'>),</span>
    <span class='nx'>i</span><span class='p'>;</span>

    <span class='k'>for</span> <span class='p'>(</span><span class='nx'>i</span> <span class='o'>=</span> <span class='mi'>0</span><span class='p'>;</span> <span class='nx'>i</span> <span class='o'>&lt;</span> <span class='nx'>ys</span><span class='p'>.</span><span class='nx'>length</span><span class='p'>;</span> <span class='nx'>i</span><span class='o'>++</span><span class='p'>)</span> <span class='p'>{</span>
        <span class='nx'>result</span><span class='p'>.</span><span class='nx'>push</span><span class='p'>(</span><span class='nx'>ys</span><span class='p'>[</span><span class='nx'>i</span><span class='p'>]);</span>
    <span class='p'>}</span>

    <span class='k'>return</span> <span class='nx'>result</span><span class='p'>;</span>
<span class='p'>}</span>
</code></pre>
</div>
<p>The most straightforward implementation of append. Callers would use it like so:</p>
<div class='highlight'><pre><code class='javascript'><span class='kd'>var</span> <span class='nx'>list</span> <span class='o'>=</span> <span class='nx'>append</span><span class='p'>([</span><span class='mi'>1</span><span class='p'>,</span> <span class='mi'>2</span><span class='p'>,</span> <span class='mi'>3</span><span class='p'>],</span> <span class='p'>[</span><span class='mi'>4</span><span class='p'>,</span> <span class='mi'>5</span><span class='p'>,</span> <span class='mi'>6</span><span class='p'>]);</span>
<span class='c1'>// list is [1, 2, 3, 4, 5, 6]</span>
</code></pre>
</div>
<p>Nothing fancy here! This essentially duplicates the existing <code>concat</code> method in javascript.</p>
<h4>Functional (Haskell)</h4><div class='highlight'><pre><code class='haskell'><span class='nf'>append</span> <span class='ow'>::</span> <span class='p'>[</span><span class='n'>a</span><span class='p'>]</span> <span class='ow'>-&gt;</span> <span class='p'>[</span><span class='n'>a</span><span class='p'>]</span> <span class='ow'>-&gt;</span> <span class='p'>[</span><span class='n'>a</span><span class='p'>]</span>
<span class='nf'>append</span> <span class='kt'>[]</span> <span class='n'>ys</span> <span class='ow'>=</span> <span class='n'>ys</span>
<span class='nf'>append</span> <span class='p'>(</span><span class='n'>x</span><span class='kt'>:</span><span class='n'>xs</span><span class='p'>)</span> <span class='n'>ys</span> <span class='ow'>=</span> <span class='n'>x</span> <span class='kt'>:</span> <span class='n'>append</span> <span class='n'>xs</span> <span class='n'>ys</span>
</code></pre>
</div>
<p>A basic recursive implementation of append. Once again, it is straightforward to use:</p>
<div class='highlight'><pre><code class='haskell'><span class='nf'>list</span> <span class='ow'>=</span> <span class='n'>append</span> <span class='p'>[</span><span class='mi'>1</span><span class='p'>,</span> <span class='mi'>2</span><span class='p'>,</span> <span class='mi'>3</span><span class='p'>]</span> <span class='p'>[</span><span class='mi'>4</span><span class='p'>,</span> <span class='mi'>5</span><span class='p'>,</span> <span class='mi'>6</span><span class='p'>]</span>
<span class='c1'>-- list is [1, 2, 3, 4, 5, 6]</span>
</code></pre>
</div>
<p>Now that we&#8217;re in Haskell, we can of course easily take advantage of partial application and write things like:</p>
<div class='highlight'><pre><code class='haskell'><span class='nf'>appendList1</span> <span class='ow'>=</span> <span class='n'>append</span> <span class='p'>[</span><span class='mi'>1</span><span class='p'>,</span> <span class='mi'>2</span><span class='p'>,</span> <span class='mi'>3</span><span class='p'>]</span>
<span class='nf'>list2</span> <span class='ow'>=</span> <span class='n'>appendList1</span> <span class='p'>[</span><span class='mi'>4</span><span class='p'>,</span> <span class='mi'>5</span><span class='p'>,</span> <span class='mi'>6</span><span class='p'>]</span>
<span class='c1'>-- list2 is [1, 2, 3, 4, 5, 6]</span>
<span class='nf'>list3</span> <span class='ow'>=</span> <span class='n'>appendList1</span> <span class='p'>[</span><span class='mi'>1</span><span class='p'>,</span> <span class='mi'>2</span><span class='p'>,</span> <span class='mi'>3</span><span class='p'>]</span>
<span class='c1'>-- list3 is [1, 2, 3, 1, 2, 3]</span>
</code></pre>
</div>
<p>But this function still just appends one list to another. It&#8217;s the same as the built in <code>++</code> function, and basically equivalent to the previous javascript example.</p>
<h4>Logic-based with unification (Prolog)</h4><div class='highlight'><pre><code class='prolog'><span class='nf'>append</span><span class='p'>([],</span><span class='nv'>Ys</span><span class='p'>,</span><span class='nv'>Ys</span><span class='p'>).</span>
<span class='nf'>append</span><span class='p'>([</span><span class='nv'>X</span><span class='p'>|</span><span class='nv'>Xs</span><span class='p'>],</span><span class='nv'>Ys</span><span class='p'>,[</span><span class='nv'>X</span><span class='p'>|</span><span class='nv'>Zs</span><span class='p'>])</span> <span class='p'>:-</span> <span class='nf'>append</span><span class='p'>(</span><span class='nv'>Xs</span><span class='p'>,</span><span class='nv'>Ys</span><span class='p'>,</span><span class='nv'>Zs</span><span class='p'>).</span>
</code></pre>
</div>
<p>At first glance, this function is just like the previous two. Note how similar it is to the Haskell example in particular, since it too is just a simple recursive function. It can be used like so:</p>
<div class='highlight'><pre><code class='prolog'><span class='s-Atom'>?-</span> <span class='nf'>append</span><span class='p'>([</span><span class='m'>1</span><span class='p'>,</span> <span class='m'>2</span><span class='p'>,</span> <span class='m'>3</span><span class='p'>],</span> <span class='p'>[</span><span class='m'>4</span><span class='p'>,</span> <span class='m'>5</span><span class='p'>,</span> <span class='m'>6</span><span class='p'>],</span> <span class='nv'>List</span><span class='p'>).</span>
<span class='nv'>List</span> <span class='o'>=</span> <span class='p'>[</span><span class='m'>1</span><span class='p'>,</span> <span class='m'>2</span><span class='p'>,</span> <span class='m'>3</span><span class='p'>,</span> <span class='m'>4</span><span class='p'>,</span> <span class='m'>5</span><span class='p'>,</span> <span class='m'>6</span><span class='p'>].</span>
</code></pre>
</div>
<p>With Prolog it is sometimes accurate to look at a rule as a function with the parameters being <code>(param1, param2, return value)</code>. If you look at the example above in this way it gives you an <em>accurate</em>, but <em>limited</em> picture of this rule. With unification, you could just as easily look at this rule as <code>(param1,
return value, param2)</code>, like so:</p>
<div class='highlight'><pre><code class='prolog'><span class='s-Atom'>?-</span> <span class='nf'>append</span><span class='p'>([</span><span class='m'>1</span><span class='p'>,</span> <span class='m'>2</span><span class='p'>,</span> <span class='m'>3</span><span class='p'>],</span> <span class='nv'>List</span><span class='p'>,</span> <span class='p'>[</span><span class='m'>1</span><span class='p'>,</span> <span class='m'>2</span><span class='p'>,</span> <span class='m'>3</span><span class='p'>,</span> <span class='m'>4</span><span class='p'>,</span> <span class='m'>5</span><span class='p'>,</span> <span class='m'>6</span><span class='p'>]).</span>
<span class='nv'>List</span> <span class='o'>=</span> <span class='p'>[</span><span class='m'>4</span><span class='p'>,</span> <span class='m'>5</span><span class='p'>,</span> <span class='m'>6</span><span class='p'>].</span>
</code></pre>
</div>
<p>Prolog solves for the missing parameter and correctly calculates the result! This is the major difference between traditional languages and a logic language. But <code>(param1, return value, param2)</code> is still not the best way to think about rules, as it breaks down when confronted with something like this:</p>
<div class='highlight'><pre><code class='prolog'><span class='s-Atom'>?-</span> <span class='nf'>append</span><span class='p'>(</span><span class='nv'>List1</span><span class='p'>,</span> <span class='nv'>List2</span><span class='p'>,</span> <span class='p'>[</span><span class='m'>1</span><span class='p'>,</span> <span class='m'>2</span><span class='p'>,</span> <span class='m'>3</span><span class='p'>]).</span>
<span class='nv'>List1</span> <span class='o'>=</span> <span class='p'>[],</span>
<span class='nv'>List2</span> <span class='o'>=</span> <span class='p'>[</span><span class='m'>1</span><span class='p'>,</span> <span class='m'>2</span><span class='p'>,</span> <span class='m'>3</span><span class='p'>]</span> <span class='p'>;</span>
<span class='nv'>List1</span> <span class='o'>=</span> <span class='p'>[</span><span class='m'>1</span><span class='p'>],</span>
<span class='nv'>List2</span> <span class='o'>=</span> <span class='p'>[</span><span class='m'>2</span><span class='p'>,</span> <span class='m'>3</span><span class='p'>]</span> <span class='p'>;</span>
<span class='nv'>List1</span> <span class='o'>=</span> <span class='p'>[</span><span class='m'>1</span><span class='p'>,</span> <span class='m'>2</span><span class='p'>],</span>
<span class='nv'>List2</span> <span class='o'>=</span> <span class='p'>[</span><span class='m'>3</span><span class='p'>]</span> <span class='p'>;</span>
<span class='nv'>List1</span> <span class='o'>=</span> <span class='p'>[</span><span class='m'>1</span><span class='p'>,</span> <span class='m'>2</span><span class='p'>,</span> <span class='m'>3</span><span class='p'>],</span>
<span class='nv'>List2</span> <span class='o'>=</span> <span class='p'>[]</span> <span class='p'>;</span>
<span class='s-Atom'>false</span><span class='p'>.</span>
</code></pre>
</div>
<p>Prolog just generated all the possible ways you could combine two lists to make <code>[1, 2, 3]</code>! All this functionality from that tiny definition of <code>append</code> up above!</p>

<p>There&#8217;s one more interesting use for append - as a lie-detector:</p>
<div class='highlight'><pre><code class='prolog'><span class='s-Atom'>?-</span> <span class='nf'>append</span><span class='p'>([</span><span class='m'>1</span><span class='p'>,</span> <span class='m'>2</span><span class='p'>],</span> <span class='p'>[</span><span class='m'>3</span><span class='p'>,</span> <span class='m'>4</span><span class='p'>],</span> <span class='p'>[</span><span class='m'>1</span><span class='p'>,</span> <span class='m'>2</span><span class='p'>,</span> <span class='m'>3</span><span class='p'>]).</span>
<span class='s-Atom'>false</span><span class='p'>.</span>
<span class='s-Atom'>?-</span> <span class='nf'>append</span><span class='p'>([</span><span class='m'>1</span><span class='p'>,</span> <span class='m'>2</span><span class='p'>],</span> <span class='p'>[</span><span class='m'>3</span><span class='p'>,</span> <span class='m'>4</span><span class='p'>],</span> <span class='p'>[</span><span class='m'>1</span><span class='p'>,</span> <span class='m'>2</span><span class='p'>,</span> <span class='m'>3</span><span class='p'>,</span> <span class='m'>4</span><span class='p'>]).</span>
<span class='s-Atom'>true</span><span class='p'>.</span>
</code></pre>
</div>
<p>All of this comes from the power of unification.</p>
<h3>Recursion</h3>
<p>When writing recursive rules in Prolog you really have to make sure to keep thinking in terms of &#8216;making this statement true&#8217; instead of your typical program execution. One thing that makes it more awkward is that you can&#8217;t use return values: every &#8216;result&#8217; has to be a another parameter. And so you end up with more intermediate variables that have little meaning, as the example below shows.</p>

<p>Since there is no such thing as a for or while loop in Prolog, you end up using recursion a lot, and you will use it more than you need to if you don&#8217;t know that Prolog actually does have higher-order functions. This is important so I&#8217;m going to say it again: <strong>Prolog has higher order functions</strong>. They&#8217;re just not widely advertised and they&#8217;re barely documented. There&#8217;s Lee Naish&#8217;s paper, <a href='http://www.cs.umbc.edu/771/papers/mu_96_02.pdf'>Higher Order logic programming in Prolog</a> and there&#8217;s also <a href='http://www.j-paine.org/dobbs/ho_span_count.html'>this nice post</a> which gives good examples of <code>maplist</code> and <code>foldr</code>.</p>

<p>The existence of <code>maplist</code> makes a big difference in how many lines of code it takes to write recursive rules in Prolog. Here&#8217;s the same recursive function in both Haskell and Prolog. Not being able to use return values makes it more awkward to read, but ultimately it&#8217;s actually not too different.</p>
<h4>Haskell</h4><div class='highlight'><pre><code class='haskell'><span class='nf'>combinations</span> <span class='ow'>::</span> <span class='p'>[</span><span class='n'>a</span><span class='p'>]</span> <span class='ow'>-&gt;</span> <span class='p'>[[</span><span class='n'>a</span><span class='p'>]]</span>
<span class='nf'>combinations</span> <span class='p'>[</span><span class='n'>x</span><span class='p'>]</span> <span class='ow'>=</span> <span class='p'>[[</span><span class='n'>x</span><span class='p'>]]</span>
<span class='nf'>combinations</span> <span class='p'>(</span><span class='n'>x</span><span class='kt'>:</span><span class='n'>xs</span><span class='p'>)</span> <span class='ow'>=</span> <span class='p'>[</span><span class='n'>x</span><span class='p'>]</span> <span class='kt'>:</span> <span class='p'>(</span><span class='n'>map</span> <span class='p'>(</span><span class='n'>x</span> <span class='kt'>:</span><span class='p'>)</span> <span class='p'>(</span><span class='n'>combinations</span> <span class='n'>xs</span><span class='p'>))</span> <span class='o'>++</span> <span class='n'>combinations</span> <span class='n'>xs</span>
</code></pre>
</div><h4>Prolog</h4><div class='highlight'><pre><code class='prolog'><span class='nf'>combinations</span><span class='p'>([</span><span class='nv'>X</span><span class='p'>],</span> <span class='p'>[[</span><span class='nv'>X</span><span class='p'>]]).</span>
<span class='nf'>combinations</span><span class='p'>([</span><span class='nv'>X</span><span class='p'>|</span><span class='nv'>XS</span><span class='p'>],</span> <span class='nv'>Result</span><span class='p'>)</span> <span class='p'>:-</span> 
    <span class='nf'>combinations</span><span class='p'>(</span><span class='nv'>XS</span><span class='p'>,</span> <span class='nv'>Comb1</span><span class='p'>),</span> 
    <span class='nf'>maplist</span><span class='p'>(</span><span class='nf'>append</span><span class='p'>([</span><span class='nv'>X</span><span class='p'>]),</span> <span class='nv'>Comb1</span><span class='p'>,</span> <span class='nv'>Comb2</span><span class='p'>),</span>
    <span class='nf'>append</span><span class='p'>([[</span><span class='nv'>X</span><span class='p'>]],</span> <span class='nv'>Comb1</span><span class='p'>,</span> <span class='nv'>Comb3</span><span class='p'>),</span> 
    <span class='nf'>append</span><span class='p'>(</span><span class='nv'>Comb2</span><span class='p'>,</span> <span class='nv'>Comb3</span><span class='p'>,</span> <span class='nv'>Result</span><span class='p'>).</span>
</code></pre>
</div>
<p>I still prefer the Haskell version :)</p>

<h2 id='full_solutions'>Full solutions</h2>

<p>Here is a nicely formatted version of my solutions to the exercises from Day 2 of Prolog. The home of the following code is <a href='https://github.com/nickknw/seven-languages-in-seven-weeks/blob/master/week-3-prolog/day2.pl'>on github</a> with the other exercises.</p>
<div id='formatted_solutions'>

<h3>Find:</h3>

<div class='question'><b>1.</b> Some implementations of a Fibonacci series and factorials. How do they work?</div>

<div class='tiny_title'>Fibonacci (from <a href='http://cubbi.com/fibonacci/prolog.html'>http://cubbi.com/fibonacci/prolog.html</a>)</div>


<div class='highlight'><pre><code class='prolog'><span class='nf'>fib</span><span class='p'>(</span><span class='m'>0</span><span class='p'>,</span><span class='m'>0</span><span class='p'>).</span>
<span class='nf'>fib</span><span class='p'>(</span><span class='m'>1</span><span class='p'>,</span><span class='m'>1</span><span class='p'>).</span>
<span class='nf'>fib</span><span class='p'>(</span><span class='nv'>N</span><span class='p'>,</span><span class='nv'>F</span><span class='p'>)</span> <span class='p'>:-</span> <span class='nf'>succ</span><span class='p'>(</span><span class='nv'>N1</span><span class='p'>,</span><span class='nv'>N</span><span class='p'>),</span> <span class='nf'>succ</span><span class='p'>(</span><span class='nv'>N2</span><span class='p'>,</span><span class='nv'>N1</span><span class='p'>),</span> <span class='nf'>fib</span><span class='p'>(</span><span class='nv'>N1</span><span class='p'>,</span><span class='nv'>F1</span><span class='p'>),</span> <span class='nf'>fib</span><span class='p'>(</span><span class='nv'>N2</span><span class='p'>,</span><span class='nv'>F2</span><span class='p'>),</span> <span class='nf'>plus</span><span class='p'>(</span><span class='nv'>F1</span><span class='p'>,</span><span class='nv'>F2</span><span class='p'>,</span><span class='nv'>F</span><span class='p'>).</span>
</code></pre>
</div>



<div class='tiny_title'>Explanation</div>
<div class='code_explanation'>
First establish the two base cases.
Next, create a rule for the recursive case:
<ol>
<li>Find N-1 and N-2</li>
<li>Find the N-1th fibonacci number</li>
<li>Find the N-2th fibonacci number</li>
<li>Add the N-1th and the N-2th fibonacci number</li>
<li>The result is the Nth fibonacci number</li>
</ol>

Pretty straightforward!
</div>

<div class='tiny_title'>Factorial (from <a href='http://boklm.eu/prolog/page_6.html'>http://boklm.eu/prolog/page_6.html</a>)</div>

<div class='highlight'><pre><code class='prolog'><span class='nf'>factorial</span><span class='p'>(</span><span class='m'>0</span><span class='p'>,</span><span class='m'>1</span><span class='p'>).</span>
<span class='nf'>factorial</span><span class='p'>(</span><span class='nv'>X</span><span class='p'>,</span><span class='nv'>Y</span><span class='p'>)</span> <span class='p'>:-</span>
  <span class='nv'>X1</span> <span class='o'>is</span> <span class='nv'>X</span> <span class='o'>-</span> <span class='m'>1</span><span class='p'>,</span>
  <span class='nf'>factorial</span><span class='p'>(</span><span class='nv'>X1</span><span class='p'>,</span><span class='nv'>Z</span><span class='p'>),</span>
  <span class='nv'>Y</span> <span class='o'>is</span> <span class='nv'>Z</span> <span class='o'>*</span> <span class='nv'>X</span><span class='p'>,!.</span>
</code></pre>
</div>



<div class='tiny_title'>Explanation</div>
<div class='code_explanation'>

First, establish the base case.
Next, create a rule for the recursive case:
<ol>
<li>Find X - 1</li>
<li>Find the factorial of X - 1</li>
<li>Multiply the result by X</li>
<li>The result is the factorial of X</li>
</ol>
</div>

<div class='question'><b>2.</b> A real-world community using Prolog. What problems are they solving with it today?</div>

<p>
Nice SO question about this: 
<ul><li><a href='http://stackoverflow.com/questions/130097/real-world-prolog-usage'>http://stackoverflow.com/questions/130097/real-world-prolog-usage</a></li></ul>
</p>

<p>
Some companies that use Prolog:
<ul>
<li><a href='http://www.meridiansystems.com/products/prolog/construction-project-management.asp'>http://www.meridiansystems.com/products/prolog/construction-project-management.asp</a></li>
<li><a href='http://www.intologic.com/'>http://www.intologic.com/</a></li>
<li><a href='http://www.sics.se/isl/sicstuswww/site/customers.html'>http://www.sics.se/isl/sicstuswww/site/customers.html</a></li>
<li>powerset (acquired by microsoft)</li>
</ul>
</p>

<p>
Dr. Dobbs article on this:
<ul>
<li><a href='http://drdobbs.com/architecture-and-design/184405220'>http://drdobbs.com/architecture-and-design/184405220</a></li>
</ul>
</p>

<div class='question'><b>3. (optional)</b> What are some of the problems of dealing with "not" expressions? Why do you have to be careful with negation in Prolog?</div>

<p>
Negation in Prolog is not <i>logical negation</i>, it is <i>negation as failure</i>.  So
<code>not(X)</code> doesn't mean that X is false (like <code>¬X</code> would), it means that X can't
be <i>proven true</i>. Something else you have to be careful with is putting negated
predicates in the right order. Negation as failure is implemented using the
<code>cut</code> and <code>fail</code> predicates. The short story is: negating a predicate can
cause subsequent predicates to be ignored.
</p>

<p>
For a better and more in-depth explanation of <code>cut</code> and negation as failure, I
strongly recommend the following links:
</p>

<ul>
<li><a href='http://pwnetics.wordpress.com/2011/04/10/negation-in-prolog/'>Negation In Prolog</a> — The author uses the wallace and grommit example from this book to show how
assuming logical negation can lead to subtle errors.</li>

<li><a href='http://cs.union.edu/~striegnk/learn-prolog-now/html/node90.html#sec.l10.negation.as.failure'>Negation as failure</a> — A highly readable explanation of how negation as failure really works. Here is
one of the opening paragraphs which really helped make it click for me:</li>
</ul>

<div class='indent'>
    <blockquote>
        As a first step, let's introduce another built in predicate fail/0. As its name
        suggests, fail is a special symbol that will immediately fail when Prolog
        encounters it as a goal. That may not sound too useful, but remember: when
        Prolog fails, it tries to backtrack. Thus fail can be viewed as an instruction
        to force backtracking. And when used in combination with cut, which blocks
        backtracking, fail enables us to write some interesting programs, and in
        particular, it lets us define exceptions to general rules.   
    </blockquote>
</div>

<p>
If you find you need more background information first, try the page where they
<a href='http://cs.union.edu/~striegnk/learn-prolog-now/html/node88.html#sec.l10.cut'>introduce cut:</a>
</p>

<h3>Do:</h3>

<div class='question'><b>1.</b> Reverse the elements of a list</div>


<div class='highlight'><pre><code class='prolog'><span class='nf'>reverse</span><span class='p'>(</span><span class='nv'>A</span><span class='p'>,</span><span class='nv'>R</span><span class='p'>)</span> <span class='p'>:-</span> <span class='nf'>reverse</span><span class='p'>(</span><span class='nv'>A</span><span class='p'>,[],</span><span class='nv'>R</span><span class='p'>).</span>
<span class='nf'>reverse</span><span class='p'>([</span><span class='nv'>X</span><span class='p'>|</span><span class='nv'>Y</span><span class='p'>],</span><span class='nv'>Z</span><span class='p'>,</span><span class='nv'>W</span><span class='p'>)</span> <span class='p'>:-</span> <span class='nf'>reverse</span><span class='p'>(</span><span class='nv'>Y</span><span class='p'>,[</span><span class='nv'>X</span><span class='p'>|</span><span class='nv'>Z</span><span class='p'>],</span><span class='nv'>W</span><span class='p'>).</span>
<span class='nf'>reverse</span><span class='p'>([],</span><span class='nv'>X</span><span class='p'>,</span><span class='nv'>X</span><span class='p'>).</span>
</code></pre>
</div>



<div class='tiny_title'>Notes</div>

<div class='code_explanation'>
I ended up using an example from a tutorial - even then it still took a bit to make sense to me. The middle accumulation parameter specifically. I'm going to try the problem that the tutorial gives immediately after:

<blockquote>
<p>Write a two-parameter version of 'reverse' that does not use the accumulating parameter idea. Use 'append' instead, for example, where one rule would be paraphrased like this ...</p>
  
<code>reverse list [X|R] by reversing R to get T, then append T to [X]</code>

<p>What about the efficiency of this version? Compare it to the given 'reverse' above.</p>
</blockquote>

This is the way I was attempting to do it first as well. It is (probably) less efficient than the first version, because when I append an element to the end of the list it likely has to walk the list each time. Don't know for sure without measuring though.
</div>


<div class='highlight'><pre><code class='prolog'><span class='nf'>reverseA</span><span class='p'>([</span><span class='nv'>X</span><span class='p'>|</span><span class='nv'>R</span><span class='p'>],</span> <span class='nv'>Result</span><span class='p'>)</span> <span class='p'>:-</span> <span class='nf'>reverse</span><span class='p'>(</span><span class='nv'>R</span><span class='p'>,</span> <span class='nv'>T</span><span class='p'>),</span> <span class='nf'>append</span><span class='p'>(</span><span class='nv'>T</span><span class='p'>,</span> <span class='p'>[</span><span class='nv'>X</span><span class='p'>],</span> <span class='nv'>Result</span><span class='p'>).</span>
<span class='nf'>reverseA</span><span class='p'>([</span><span class='nv'>X</span><span class='p'>],</span> <span class='nv'>X</span><span class='p'>).</span>
</code></pre>
</div>



<div class='question'><b>2.</b> Find the smallest element of a list</div>


<div class='highlight'><pre><code class='prolog'><span class='nf'>min</span><span class='p'>(</span><span class='nv'>A</span><span class='p'>,</span><span class='nv'>A</span><span class='p'>,</span><span class='nv'>A</span><span class='p'>).</span>
<span class='nf'>min</span><span class='p'>(</span><span class='nv'>A</span><span class='p'>,</span><span class='nv'>B</span><span class='p'>,</span><span class='nv'>B</span><span class='p'>)</span> <span class='p'>:-</span> <span class='nv'>B</span> <span class='o'>&lt;</span> <span class='nv'>A</span><span class='p'>.</span>
<span class='nf'>min</span><span class='p'>(</span><span class='nv'>A</span><span class='p'>,</span><span class='nv'>B</span><span class='p'>,</span><span class='nv'>A</span><span class='p'>)</span> <span class='p'>:-</span> <span class='nv'>A</span> <span class='o'>&lt;</span> <span class='nv'>B</span><span class='p'>.</span>

<span class='nf'>minInList</span><span class='p'>([</span><span class='nv'>X</span><span class='p'>|</span><span class='nv'>XS</span><span class='p'>],</span> <span class='nv'>M</span><span class='p'>)</span> <span class='p'>:-</span> <span class='nf'>minInList</span><span class='p'>(</span><span class='nv'>XS</span><span class='p'>,</span> <span class='nv'>M1</span><span class='p'>),</span> <span class='nf'>min</span><span class='p'>(</span><span class='nv'>X</span><span class='p'>,</span> <span class='nv'>M1</span><span class='p'>,</span> <span class='nv'>M</span><span class='p'>).</span>
<span class='nf'>minInList</span><span class='p'>([</span><span class='nv'>X</span><span class='p'>],</span> <span class='nv'>X</span><span class='p'>).</span>
</code></pre>
</div>



<div class='question'><b>3.</b> Sort the elements of a list.</div>


<div class='highlight'><pre><code class='prolog'><span class='c1'>% I&#39;m just going to go for a very simple sort.</span>

<span class='nf'>takeout</span><span class='p'>(</span><span class='nv'>X</span><span class='p'>,</span> <span class='p'>[</span><span class='nv'>X</span><span class='p'>|</span><span class='nv'>R</span><span class='p'>],</span> <span class='nv'>R</span><span class='p'>).</span>
<span class='nf'>takeout</span><span class='p'>(</span><span class='nv'>X</span><span class='p'>,</span> <span class='p'>[</span><span class='nv'>F</span><span class='p'>|</span><span class='nv'>R</span><span class='p'>],</span> <span class='p'>[</span><span class='nv'>F</span><span class='p'>|</span><span class='nv'>S</span><span class='p'>])</span> <span class='p'>:-</span> <span class='nf'>takeout</span><span class='p'>(</span><span class='nv'>X</span><span class='p'>,</span><span class='nv'>R</span><span class='p'>,</span><span class='nv'>S</span><span class='p'>).</span>

<span class='nf'>mySort</span><span class='p'>(</span><span class='nv'>List</span><span class='p'>,</span> <span class='p'>[</span><span class='nv'>Min</span><span class='p'>|</span><span class='nv'>Sorted</span><span class='p'>])</span> <span class='p'>:-</span> 
    <span class='nf'>minInList</span><span class='p'>(</span><span class='nv'>List</span><span class='p'>,</span> <span class='nv'>Min</span><span class='p'>),</span> 
    <span class='nf'>takeout</span><span class='p'>(</span><span class='nv'>Min</span><span class='p'>,</span> <span class='nv'>List</span><span class='p'>,</span> <span class='nv'>Rest</span><span class='p'>),</span> 
    <span class='nf'>mySort</span><span class='p'>(</span><span class='nv'>Rest</span><span class='p'>,</span> <span class='nv'>Sorted</span><span class='p'>).</span>
<span class='nf'>mySort</span><span class='p'>([</span><span class='nv'>X</span><span class='p'>],</span> <span class='p'>[</span><span class='nv'>X</span><span class='p'>]).</span>
</code></pre>
</div>



</div>
<p>Next in this series: <a href='/blog/2012/08/06/seven-languages-week-3-day-3/'>Day 3 of Prolog</a></p>
  </div>

  <div style="margin-top:20px; font-size:14px;">
    <a href="/blog/2012/07/17/seven-languages-week-3-day-2/#disqus_thread" data-disqus-identifier="/blog/2012/07/17/seven-languages-week-3-day-2">Comments</a>
  </div>

    <hr class="fancyrule" />

  <div>
  <h1 style="margin:0px"><a href="/blog/2012/02/05/seven-languages-week-3-day-1/">
  Seven Languages: Week 3 (Prolog) - Day 1
  </a></h1>
  <div class="faded" style="font-size:14px; margin-bottom:5px;">05 Feb 2012</div>
  <p>Although I am not yet halfway through the book, I am pretty sure that Prolog will win the &#8216;most foreign language&#8217; category with ease. Going in, I knew Prolog was fairly old (born in 1972) and that it was a logic-based language, but I could not have estimated how, for lack of a better word, <em>picky</em> it would be.</p>

<p>My troubles started at installation - Bruce Tate uses GNU Prolog in the book, and I spent far too long trying to get that working only to discover that some library functions essential to the exercises (<code>fd_domain</code>, <code>fd_all_different</code>) just caused GNU Prolog to crash on my machine. I will elaborate on this more in Day 3, but for anyone encountering this post who is in a similar situation, just go use SWI Prolog instead.</p>

<p>Prolog heavily relies on recursion but making a recursive rule is not the same as making a recursive function in functional languages. It is subtly different, and way easier to get wrong; you have to have an <strong>extremely</strong> clear mental model of how Prolog operates (which I still don&#8217;t). I will expand more on this in a future post.</p>

<p>Despite all this, during the course of Week 3 I have been convinced that logic programming can be extremely powerful. If you know how to define a problem in terms that Prolog understands, then you can write a program that solves a problem without having the slightest idea of how to actually solve it (a good example is Sudoku, which shows up in Day 3). Logic languages are the closest I have seen to the unattainable ideal of &#8216;writing a program that will look at the problem and write a program to solve it for you&#8217;.</p>
<div class='interjection'><p>
(This article is part of a series of posts I am doing about my journey through the exercises of the book <a href='http://pragprog.com/book/btlang/seven-languages-in-seven-weeks'>Seven Languages In Seven Weeks</a>. The article previous to this one is <a href='/blog/2012/01/16/seven-languages-week-2-day-3/'>Week 2 (Io) - Day 3</a>. For an overview see the <a href='/projects/seven-languages-in-seven-weeks/'>project page</a>.)
</p></div>
<h2 id='topics_covered'>Topics covered</h2>

<p>Day 1 covered the basic structural elements of Prolog. There are three kinds of statements in a Prolog program: <strong>facts</strong>, <strong>rules</strong>, and <strong>queries</strong>.</p>

<p>A fact is a simple statement that essentially adds a nugget of information to a database. Here are some facts:</p>
<div class='highlight'><pre><code class='prolog'><span class='s-Atom'>daytime</span><span class='p'>.</span>
<span class='s-Atom'>clear_skies</span><span class='p'>.</span>

<span class='nf'>round</span><span class='p'>(</span><span class='s-Atom'>earth</span><span class='p'>).</span>
<span class='nf'>round</span><span class='p'>(</span><span class='s-Atom'>ball</span><span class='p'>).</span>

<span class='nf'>small</span><span class='p'>(</span><span class='s-Atom'>mouse</span><span class='p'>).</span>
<span class='nf'>small</span><span class='p'>(</span><span class='s-Atom'>ball</span><span class='p'>).</span>
</code></pre>
</div>
<p>A rule is a statement that relates facts and rules together. You can almost (but not quite) think of them as functions. Here are some rules:</p>
<div class='highlight'><pre><code class='prolog'><span class='nf'>time_to_play</span> <span class='o'>:-</span> <span class='s-Atom'>daytime</span><span class='p'>,</span> <span class='s-Atom'>clear_skies</span><span class='p'>.</span>

<span class='nf'>suitable_for_playing_with</span><span class='p'>(</span><span class='nv'>X</span><span class='p'>)</span> <span class='p'>:-</span> <span class='nf'>round</span><span class='p'>(</span><span class='nv'>X</span><span class='p'>),</span> <span class='nf'>small</span><span class='p'>(</span><span class='nv'>X</span><span class='p'>).</span>

<span class='nf'>does_nick_want_to_play_with</span><span class='p'>(</span><span class='nv'>X</span><span class='p'>)</span> <span class='p'>:-</span> <span class='s-Atom'>time_to_play</span><span class='p'>,</span> <span class='nf'>suitable_for_playing_with</span><span class='p'>(</span><span class='nv'>X</span><span class='p'>).</span>
</code></pre>
</div>
<p>If you collect all of the preceding statements and put them in a <code>hello.pl</code> file then you have a valid Prolog program. To actually get some useful output from it, we can load this program into the prolog interpreter, and query this database we&#8217;ve built up like so:</p>
<div class='highlight'><pre><code class='prolog'><span class='s-Atom'>?-</span> <span class='p'>[</span><span class='s-Atom'>&#39;hello.pl&#39;</span><span class='p'>].</span>
<span class='c1'>% hello.pl compiled 0.00 sec, 3,352 bytes</span>
<span class='s-Atom'>true</span><span class='p'>.</span>

<span class='c1'>% Let&#39;s test out the facts:</span>

<span class='s-Atom'>?-</span> <span class='s-Atom'>daytime</span><span class='p'>.</span>
<span class='s-Atom'>true</span><span class='p'>.</span>

<span class='s-Atom'>?-</span> <span class='nf'>round</span><span class='p'>(</span><span class='s-Atom'>earth</span><span class='p'>).</span>
<span class='s-Atom'>true</span><span class='p'>.</span>

<span class='s-Atom'>?-</span> <span class='nf'>round</span><span class='p'>(</span><span class='s-Atom'>cube</span><span class='p'>).</span>
<span class='s-Atom'>false</span><span class='p'>.</span>

<span class='s-Atom'>?-</span> <span class='nf'>round</span><span class='p'>(</span><span class='nv'>What</span><span class='p'>).</span> <span class='c1'>% Notice the capital letter here. Uppercase = variable, lowercase = atom.</span>
<span class='nv'>What</span> <span class='o'>=</span> <span class='s-Atom'>earth</span> <span class='p'>;</span>
<span class='nv'>What</span> <span class='o'>=</span> <span class='s-Atom'>ball</span> <span class='p'>;</span>

<span class='c1'>% And now for the rules:</span>

 <span class='s-Atom'>?-</span> <span class='s-Atom'>time_to_play</span><span class='p'>.</span>
<span class='s-Atom'>true</span><span class='p'>.</span>

<span class='s-Atom'>?-</span> <span class='nf'>suitable_for_playing_with</span><span class='p'>(</span><span class='s-Atom'>earth</span><span class='p'>).</span>
<span class='s-Atom'>false</span><span class='p'>.</span>

<span class='s-Atom'>?-</span> <span class='nf'>suitable_for_playing_with</span><span class='p'>(</span><span class='s-Atom'>ball</span><span class='p'>).</span>
<span class='s-Atom'>true</span><span class='p'>.</span>

<span class='s-Atom'>?-</span> <span class='nf'>does_nick_want_to_play_with</span><span class='p'>(</span><span class='s-Atom'>earth</span><span class='p'>).</span>
<span class='s-Atom'>false</span><span class='p'>.</span>

<span class='s-Atom'>?-</span> <span class='nf'>does_nick_want_to_play_with</span><span class='p'>(</span><span class='s-Atom'>ball</span><span class='p'>).</span>
<span class='s-Atom'>true</span><span class='p'>.</span>

<span class='s-Atom'>?-</span> <span class='nf'>does_nick_want_to_play_with</span><span class='p'>(</span><span class='nv'>What</span><span class='p'>).</span>
<span class='nv'>What</span> <span class='o'>=</span> <span class='s-Atom'>ball</span><span class='p'>.</span>
</code></pre>
</div>
<h2 id='highlights_from_exercises'>Highlights from exercises</h2>

<p>The exercises in Day 1 aren&#8217;t terribly interesting, so instead I&#8217;ll show you an example from an earlier part of the book that threw me into confusion for a while. The goal of the following snippet of Prolog is to assign map colours such that no state borders on another state with the same colour.</p>

<p>When I read this I flipped through the next few pages looking for the rest of the program. But there isn&#8217;t any more - this is it!</p>
<div class='highlight'><pre><code class='prolog'><span class='nf'>different</span><span class='p'>(</span><span class='s-Atom'>red</span><span class='p'>,</span> <span class='s-Atom'>green</span><span class='p'>).</span> <span class='nf'>different</span><span class='p'>(</span><span class='s-Atom'>red</span><span class='p'>,</span> <span class='s-Atom'>blue</span><span class='p'>).</span>
<span class='nf'>different</span><span class='p'>(</span><span class='s-Atom'>green</span><span class='p'>,</span> <span class='s-Atom'>red</span><span class='p'>).</span> <span class='nf'>different</span><span class='p'>(</span><span class='s-Atom'>green</span><span class='p'>,</span> <span class='s-Atom'>blue</span><span class='p'>).</span>
<span class='nf'>different</span><span class='p'>(</span><span class='s-Atom'>blue</span><span class='p'>,</span> <span class='s-Atom'>red</span><span class='p'>).</span> <span class='nf'>different</span><span class='p'>(</span><span class='s-Atom'>blue</span><span class='p'>,</span> <span class='s-Atom'>green</span><span class='p'>).</span>

<span class='nf'>coloring</span><span class='p'>(</span><span class='nv'>Alabama</span><span class='p'>,</span> <span class='nv'>Mississippi</span><span class='p'>,</span> <span class='nv'>Georgia</span><span class='p'>,</span> <span class='nv'>Tennessee</span><span class='p'>,</span> <span class='nv'>Florida</span><span class='p'>)</span> <span class='p'>:-</span>
    <span class='nf'>different</span><span class='p'>(</span><span class='nv'>Mississippi</span><span class='p'>,</span> <span class='nv'>Tennessee</span><span class='p'>),</span>
    <span class='nf'>different</span><span class='p'>(</span><span class='nv'>Mississippi</span><span class='p'>,</span> <span class='nv'>Alabama</span><span class='p'>),</span>
    <span class='nf'>different</span><span class='p'>(</span><span class='nv'>Alabama</span><span class='p'>,</span> <span class='nv'>Tennessee</span><span class='p'>),</span>
    <span class='nf'>different</span><span class='p'>(</span><span class='nv'>Alabama</span><span class='p'>,</span> <span class='nv'>Mississippi</span><span class='p'>),</span>
    <span class='nf'>different</span><span class='p'>(</span><span class='nv'>Alabama</span><span class='p'>,</span> <span class='nv'>Georgia</span><span class='p'>),</span>
    <span class='nf'>different</span><span class='p'>(</span><span class='nv'>Alabama</span><span class='p'>,</span> <span class='nv'>Florida</span><span class='p'>),</span>
    <span class='nf'>different</span><span class='p'>(</span><span class='nv'>Georgia</span><span class='p'>,</span> <span class='nv'>Florida</span><span class='p'>),</span>
    <span class='nf'>different</span><span class='p'>(</span><span class='nv'>Georgia</span><span class='p'>,</span> <span class='nv'>Tennessee</span><span class='p'>).</span>
</code></pre>
</div>
<p>This program aims to colour these <strong>five</strong> states with <strong>three</strong> colours (such that no states of the same colour share borders). When we query this we get:</p>
<div class='highlight'><pre><code class='prolog'><span class='s-Atom'>?-</span> <span class='nf'>coloring</span><span class='p'>(</span><span class='nv'>Alabama</span><span class='p'>,</span> <span class='nv'>Mississippi</span><span class='p'>,</span> <span class='nv'>Georgia</span><span class='p'>,</span> <span class='nv'>Tennessee</span><span class='p'>,</span> <span class='nv'>Florida</span><span class='p'>).</span>
<span class='nv'>Alabama</span> <span class='o'>=</span> <span class='s-Atom'>blue</span><span class='p'>,</span>
<span class='nv'>Mississippi</span> <span class='o'>=</span> <span class='nv'>Georgia</span><span class='p'>,</span> <span class='nv'>Georgia</span> <span class='o'>=</span> <span class='s-Atom'>red</span><span class='p'>,</span>
<span class='nv'>Tennessee</span> <span class='o'>=</span> <span class='nv'>Florida</span><span class='p'>,</span> <span class='nv'>Florida</span> <span class='o'>=</span> <span class='s-Atom'>green</span> <span class='p'>.</span>
</code></pre>
</div>
<p><img alt='Coloured map of states showing Mississippi and Georgia = red, Tennessee and Florida = green, and Alabama = blue.' src='/img/projects/seven-languages/state-colouring.png' /></p>

<p>The program appears to be just the problem definition restated, and yet somehow Prolog can produce a correct answer!</p>

<p><strong>DISCLAIMER:</strong> I am not a Prolog expert and as such the following explanation will be a bit hand wavy. Please let me know if you spot any glaring inaccuracies.</p>

<p>Prolog is trying to unify both sides of our rule and answer the question &#8220;What values can I set these five variables to in order to make all of the following series of statements true&#8221;. It knows there are six facts about &#8220;different-ness&#8221; and keeps on trying different combinations of these facts.</p>

<p>Take as an example the first statement of the <strong>rule</strong> <code>different(Mississippi,
Tennessee)</code>. It might first try the <strong>fact</strong> <code>different(red, green)</code>, then continue on with the assumption that now <code>Mississippi = red</code> and <code>Tennessee =
green</code>, and see if it can still make the other statements true.</p>

<p>Hopefully that more or less makes sense. But in case it doesn&#8217;t, <strong>let&#8217;s take a different tack now</strong>. Pretend our rule is a mathematical equation: Prolog is trying to solve for five variables, given only a little bit of knowledge about numbers. As far as it is concerned, you may as well have given it this:</p>
<div class='highlight'><pre><code class='prolog'><span class='nf'>different</span><span class='p'>(</span><span class='m'>1</span><span class='p'>,</span> <span class='m'>2</span><span class='p'>).</span> <span class='nf'>different</span><span class='p'>(</span><span class='m'>1</span><span class='p'>,</span> <span class='m'>3</span><span class='p'>).</span>
<span class='nf'>different</span><span class='p'>(</span><span class='m'>2</span><span class='p'>,</span> <span class='m'>1</span><span class='p'>).</span> <span class='nf'>different</span><span class='p'>(</span><span class='m'>2</span><span class='p'>,</span> <span class='m'>3</span><span class='p'>).</span>
<span class='nf'>different</span><span class='p'>(</span><span class='m'>3</span><span class='p'>,</span> <span class='m'>1</span><span class='p'>).</span> <span class='nf'>different</span><span class='p'>(</span><span class='m'>3</span><span class='p'>,</span> <span class='m'>2</span><span class='p'>).</span>

<span class='nf'>solve_for</span><span class='p'>(</span><span class='nv'>A</span><span class='p'>,</span> <span class='nv'>B</span><span class='p'>,</span> <span class='nv'>C</span><span class='p'>,</span> <span class='nv'>D</span><span class='p'>,</span> <span class='nv'>E</span><span class='p'>)</span> <span class='p'>:-</span>
    <span class='nf'>different</span><span class='p'>(</span><span class='nv'>B</span><span class='p'>,</span> <span class='nv'>D</span><span class='p'>),</span>
    <span class='nf'>different</span><span class='p'>(</span><span class='nv'>B</span><span class='p'>,</span> <span class='nv'>A</span><span class='p'>),</span>
    <span class='nf'>different</span><span class='p'>(</span><span class='nv'>A</span><span class='p'>,</span> <span class='nv'>D</span><span class='p'>),</span>
    <span class='nf'>different</span><span class='p'>(</span><span class='nv'>A</span><span class='p'>,</span> <span class='nv'>B</span><span class='p'>),</span>
    <span class='nf'>different</span><span class='p'>(</span><span class='nv'>A</span><span class='p'>,</span> <span class='nv'>C</span><span class='p'>),</span>
    <span class='nf'>different</span><span class='p'>(</span><span class='nv'>A</span><span class='p'>,</span> <span class='nv'>E</span><span class='p'>),</span>
    <span class='nf'>different</span><span class='p'>(</span><span class='nv'>C</span><span class='p'>,</span> <span class='nv'>E</span><span class='p'>),</span>
    <span class='nf'>different</span><span class='p'>(</span><span class='nv'>C</span><span class='p'>,</span> <span class='nv'>D</span><span class='p'>).</span>
</code></pre>
</div>
<p>In which case you would receive an answer like:</p>
<div class='highlight'><pre><code class='prolog'><span class='s-Atom'>?-</span> <span class='nf'>solve_for</span><span class='p'>(</span><span class='nv'>A</span><span class='p'>,</span> <span class='nv'>B</span><span class='p'>,</span> <span class='nv'>C</span><span class='p'>,</span> <span class='nv'>D</span><span class='p'>,</span> <span class='nv'>E</span><span class='p'>).</span>
<span class='nv'>A</span> <span class='o'>=</span> <span class='m'>3</span><span class='p'>,</span>
<span class='nv'>B</span> <span class='o'>=</span> <span class='nv'>C</span><span class='p'>,</span> <span class='nv'>C</span> <span class='o'>=</span> <span class='m'>1</span><span class='p'>,</span>
<span class='nv'>D</span> <span class='o'>=</span> <span class='nv'>E</span><span class='p'>,</span> <span class='nv'>E</span> <span class='o'>=</span> <span class='m'>2</span> <span class='p'>.</span>
</code></pre>
</div>
<p>Easy peasy, right?</p>

<p><strong>UPDATE:</strong> Thanks for the great comments, both below on my <a href='#disqus_thread'>blog comments</a> and also <a href='http://www.reddit.com/r/programming/comments/pd9z1/seven_languages_day_1_of_prolog/'>on reddit</a>. There are a few in particular that helped me learn more that I would like to highlight and save for posterity.</p>

<p><a href='http://www.storytotell.org/'>Daniel Lyons</a> and <a href='http://users.ecs.soton.ac.uk/mal/'>Michael Leuschel</a> pointed out some variations on solving this map colouring problem.</p>

<p>Daniel showed how to <a href='#dsq-comment-430894811'>minimize redundancy</a> when declaring red, green and blue as colours that are <code>different</code> from each other:</p>
<blockquote>
<p>The map example is wonderful! I would probably make the map coloring a little more abstract like so:</p>

<div class='highlight'><pre><code class='prolog'><span class='nf'>color</span><span class='p'>(</span><span class='s-Atom'>red</span><span class='p'>).</span> <span class='nf'>color</span><span class='p'>(</span><span class='s-Atom'>green</span><span class='p'>).</span> <span class='nf'>color</span><span class='p'>(</span><span class='s-Atom'>blue</span><span class='p'>).</span>
<span class='nf'>different</span><span class='p'>(</span><span class='nv'>X</span><span class='p'>,</span> <span class='nv'>Y</span><span class='p'>)</span> <span class='p'>:-</span> <span class='nf'>color</span><span class='p'>(</span><span class='nv'>X</span><span class='p'>),</span> <span class='nf'>color</span><span class='p'>(</span><span class='nv'>Y</span><span class='p'>),</span> <span class='nv'>X</span> <span class='s-Atom'>\=</span> <span class='nv'>Y</span><span class='p'>.</span>
</code></pre>
</div>


</blockquote>
<p>Michael Leuschel showed how <a href='#dsq-comment-431117487'>this solution could take advantage</a> of <a href='http://www.swi-prolog.org/man/clpfd.html'>CLP(FD)</a> (a module that can <strong>drastically</strong> improve performance when dealing with larger data sets) and was also kind enough to <a href='#dsq-comment-432664414'>explain labeling to me</a>:</p>
<blockquote>

<p>Another solution would be to use the different operator <code>#\=</code> from clp(fd):</p>


<div class='highlight'><pre><code class='prolog'><span class='p'>:-</span> <span class='nf'>use_module</span><span class='p'>(</span><span class='nf'>library</span><span class='p'>(</span><span class='s-Atom'>clpfd</span><span class='p'>)).</span>
<span class='nf'>different</span><span class='p'>(</span><span class='nv'>X</span><span class='p'>,</span><span class='nv'>Y</span><span class='p'>)</span> <span class='p'>:-</span> <span class='nv'>X</span> <span class='s-Atom'>in</span> <span class='m'>1</span><span class='p'>..</span><span class='m'>3</span><span class='p'>,</span> <span class='nv'>Y</span> <span class='s-Atom'>in</span> <span class='m'>1</span><span class='p'>..</span><span class='m'>3</span><span class='p'>,</span> <span class='nv'>X</span> <span class='s-Atom'>#\=</span><span class='nv'>Y</span><span class='p'>.</span>
</code></pre>
</div>



<p>You would then need to add a call to <code>labeling</code> after setting up the constraints:</p>


<div class='highlight'><pre><code class='prolog'><span class='nf'>solve_for</span><span class='p'>([</span><span class='nv'>A</span><span class='p'>,</span> <span class='nv'>B</span><span class='p'>,</span> <span class='nv'>C</span><span class='p'>,</span> <span class='nv'>D</span><span class='p'>,</span> <span class='nv'>E</span><span class='p'>])</span> <span class='p'>:-</span>
<span class='nf'>different</span><span class='p'>(</span><span class='nv'>B</span><span class='p'>,</span> <span class='nv'>D</span><span class='p'>),</span> <span class='nf'>different</span><span class='p'>(</span><span class='nv'>B</span><span class='p'>,</span> <span class='nv'>A</span><span class='p'>),</span> <span class='nf'>different</span><span class='p'>(</span><span class='nv'>A</span><span class='p'>,</span> <span class='nv'>D</span><span class='p'>),</span> <span class='nf'>different</span><span class='p'>(</span><span class='nv'>A</span><span class='p'>,</span> <span class='nv'>B</span><span class='p'>),</span>
<span class='nf'>different</span><span class='p'>(</span><span class='nv'>A</span><span class='p'>,</span> <span class='nv'>C</span><span class='p'>),</span> <span class='nf'>different</span><span class='p'>(</span><span class='nv'>A</span><span class='p'>,</span> <span class='nv'>E</span><span class='p'>),</span>
<span class='nf'>different</span><span class='p'>(</span><span class='nv'>C</span><span class='p'>,</span> <span class='nv'>E</span><span class='p'>),</span> <span class='nf'>different</span><span class='p'>(</span><span class='nv'>C</span><span class='p'>,</span> <span class='nv'>D</span><span class='p'>)</span> <span class='p'>,</span><span class='nf'>labeling</span><span class='p'>([],[</span><span class='nv'>A</span><span class='p'>,</span> <span class='nv'>B</span><span class='p'>,</span> <span class='nv'>C</span><span class='p'>,</span> <span class='nv'>D</span><span class='p'>,</span> <span class='nv'>E</span><span class='p'>]).</span>
</code></pre>
</div>



<p>This should be more efficient than the original, as you first set up the constraints and only *then* start enumerating candidate solutions.
(Of course this performance difference does not matter for such a small graph; it can make a huge difference for larger graphs.)</p>

<p><a href='#dsq-comment-431117487'>...continued in comments</a></p>

</blockquote>
<p><a href='http://egonelbre.com/'>Egon Elbre</a> and <a href='http://www.reddit.com/user/gecko'>gecko</a> both helped explain different things about Prolog to me.</p>

<p>Egon <a href='https://gist.github.com/1755115'>used relational databases as a metaphor</a> to explain the map colouring example.</p>
<div class='highlight'><pre><code class='prolog'><span class='nf'>round</span><span class='p'>(</span><span class='s-Atom'>earth</span><span class='p'>).</span>
<span class='nf'>round</span><span class='p'>(</span><span class='s-Atom'>ball</span><span class='p'>).</span>

<span class='nf'>small</span><span class='p'>(</span><span class='s-Atom'>mouse</span><span class='p'>).</span>
<span class='nf'>small</span><span class='p'>(</span><span class='s-Atom'>ball</span><span class='p'>).</span>

<span class='c1'>% I want to have tables `round` and `small`</span>
<span class='c1'>% `round` should contain `earth` and `ball`</span>
<span class='c1'>% `small` should contain `mouse` and `ball`</span>

<span class='nf'>time_to_play</span> <span class='o'>:-</span> <span class='s-Atom'>daytime</span><span class='p'>,</span> <span class='s-Atom'>clear_skies</span><span class='p'>.</span>

<span class='c1'>% I have empty table (fact) `time_to_play` if</span>
<span class='c1'>% there are two other tables (facts) `daytime` and `clear_skies`</span>

<span class='nf'>suitable_for_playing_with</span><span class='p'>(</span><span class='nv'>X</span><span class='p'>)</span> <span class='p'>:-</span> <span class='nf'>round</span><span class='p'>(</span><span class='nv'>X</span><span class='p'>),</span> <span class='nf'>small</span><span class='p'>(</span><span class='nv'>X</span><span class='p'>).</span>

<span class='c1'>% I want to have a table `suitable_for_playing_with`</span>
<span class='c1'>% such that each value in it must be in tables `round` and `small`</span>
</code></pre>
</div>
<p>gecko <a href='http://www.reddit.com/r/programming/comments/pd9z1/seven_languages_day_1_of_prolog/c3ojly3?context=1'>introduced me to Datalog</a> and made me realize that knowing Prolog well can be useful and pay off even when developing systems in other languages.</p>

<blockquote>
<p>There are actually lots of languages that provide prologs for exactly this purpose. You&#8217;ve found Perl&#8217;s, but there&#8217;s also small prologs for C#, Python, Ruby, and more. Generally, these implement a subset of Prolog called <a href='https://en.wikipedia.org/wiki/Datalog'>Datalog</a>, which is optimized specifically to be used as a kind of query language or database from other languages.</p>

<blockquote>
<p>(part of my reply) &#8230;I haven&#8217;t used Prolog enough to know - do Datalog&#8217;s restrictions turn out to be a big limiter in practice? Does it flat out stop you from being able to solve some things? Is it just a bit less expressive?</p>
</blockquote>

<p>I&#8217;ve never found it to be an issue in practice for what I&#8217;ve wanted Datalog for, but I&#8217;m sure it&#8217;d depend on what you&#8217;re doing. Datalog/Prolog-in-practice tends to show up in relatively narrow areas where the problem can be described declaratively with relative ease. The restrictions imposed by Datalog have never, in my experience, gotten in the way in those areas. On the other hand, if I were using Prolog as the sole language I wanted, rather than as an auxiliary language, I think that at least the recursion restrictions would drive me somewhat batty.</p>
</blockquote>

<p>Thanks for all these informative comments everyone, I learned more about Prolog and have been given a few good reason to keep at it.</p>

<h2 id='full_solutions'>Full solutions</h2>

<p>Here is a nicely formatted version of my solutions to the exercises from Day 1 of Prolog. The home of the following code is <a href='https://github.com/nickknw/seven-languages-in-seven-weeks/blob/master/week-3-prolog/day1.pl'>on github</a> with the other exercises.</p>
<div id='formatted_solutions'>

<h3>Find:</h3>

<div class='question'>1. Some free Prolog tutorials</div>

<ul>
<li><a href='http://www.lix.polytechnique.fr/~liberti/public/computing/prog/prolog/prolog-tutorial.html'>http://www.lix.polytechnique.fr/~liberti/public/computing/prog/prolog/prolog-tutorial.html</a></li>
<li><a href='http://www.csupomona.edu/~jrfisher/www/prolog_tutorial/contents.html'>http://www.csupomona.edu/~jrfisher/www/prolog_tutorial/contents.html</a></li>
</ul>

<div class='question'>2. A support forum (there are several)</div>

<ul>
<li><a href='http://old.nabble.com/SWI-Prolog-f448.html'>http://old.nabble.com/SWI-Prolog-f448.html</a></li>
<li><a href='http://mail.gnu.org/pipermail/users-prolog/'>http://mail.gnu.org/pipermail/users-prolog/</a></li>
<li><a href='http://www.reddit.com/r/prolog'>http://www.reddit.com/r/prolog</a></li>
</ul>


<div class='question'>3. One online reference for the Prolog version you're using</div>

<ul>
<li><a href='http://www.swi-prolog.org/pldoc/index.html'>http://www.swi-prolog.org/pldoc/index.html</a></li>
</ul>

<h3>Do:</h3>

<div class='question'>1. Make a simple knowledge base. Represent some of your favorite books and authors.</div>


<div class='highlight'><pre><code class='prolog'><span class='nf'>book</span><span class='p'>(</span><span class='s-Atom'>&#39;The Name Of The Wind&#39;</span><span class='p'>,</span> <span class='s-Atom'>&#39;Patrick Rothfuss&#39;</span><span class='p'>).</span>
<span class='nf'>book</span><span class='p'>(</span><span class='s-Atom'>&#39;Anathem&#39;</span><span class='p'>,</span> <span class='s-Atom'>&#39;Neal Stephenson&#39;</span><span class='p'>).</span>
<span class='nf'>book</span><span class='p'>(</span><span class='s-Atom'>&#39;The Skystone&#39;</span><span class='p'>,</span> <span class='s-Atom'>&#39;Jack Whyte&#39;</span><span class='p'>).</span>
<span class='nf'>book</span><span class='p'>(</span><span class='s-Atom'>&#39;The Singing Sword&#39;</span><span class='p'>,</span> <span class='s-Atom'>&#39;Jack Whyte&#39;</span><span class='p'>).</span>
<span class='nf'>book</span><span class='p'>(</span><span class='s-Atom'>&#39;Rapid Development&#39;</span><span class='p'>,</span> <span class='s-Atom'>&#39;Steve McConnell&#39;</span><span class='p'>).</span>
<span class='nf'>book</span><span class='p'>(</span><span class='s-Atom'>&#39;The Pragmatic Programmer&#39;</span><span class='p'>,</span> <span class='s-Atom'>&#39;Andy Hunt &amp; Dave Thomas&#39;</span><span class='p'>).</span>
<span class='nf'>book</span><span class='p'>(</span><span class='s-Atom'>&#39;Seven Languages In Seven Weeks&#39;</span><span class='p'>,</span> <span class='s-Atom'>&#39;Bruce Tate&#39;</span><span class='p'>).</span>
</code></pre>
</div>



<div class='question'>2. Find all books in your knowledge base written by one author.</div>


<div class='highlight'><pre><code class='prolog'><span class='s-Atom'>?-</span> <span class='nf'>book</span><span class='p'>(</span><span class='nv'>What</span><span class='p'>,</span> <span class='s-Atom'>&#39;Neal Stephenson&#39;</span><span class='p'>).</span>

<span class='nv'>What</span> <span class='o'>=</span> <span class='s-Atom'>&#39;Anathem&#39;</span> <span class='s-Atom'>?</span> <span class='p'>;</span>

<span class='s-Atom'>?-</span> <span class='nf'>book</span><span class='p'>(</span><span class='nv'>What</span><span class='p'>,</span> <span class='s-Atom'>&#39;Jack White&#39;</span><span class='p'>).</span>

<span class='nv'>What</span> <span class='o'>=</span> <span class='s-Atom'>&#39;The Skystone&#39;</span> <span class='s-Atom'>?</span> <span class='p'>;</span>

<span class='nv'>What</span> <span class='o'>=</span> <span class='s-Atom'>&#39;The Singing Sword&#39;</span> <span class='s-Atom'>?</span> <span class='p'>;</span>
</code></pre>
</div>



<div class='question'>3. Make a knowledge base representing musicians and instruments. Also represent musicians and their genre of music.</div>


<div class='highlight'><pre><code class='prolog'><span class='nf'>musician_instrument</span><span class='p'>(</span><span class='s-Atom'>&#39;Hansi Kursch&#39;</span><span class='p'>,</span> <span class='s-Atom'>vocals</span><span class='p'>).</span>
<span class='nf'>musician_instrument</span><span class='p'>(</span><span class='s-Atom'>&#39;Hansi Kursch&#39;</span><span class='p'>,</span> <span class='s-Atom'>bass</span><span class='p'>).</span>
<span class='nf'>musician_instrument</span><span class='p'>(</span><span class='s-Atom'>&#39;Andre Olbrich&#39;</span><span class='p'>,</span> <span class='s-Atom'>guitar</span><span class='p'>).</span>
<span class='nf'>musician_instrument</span><span class='p'>(</span><span class='s-Atom'>&#39;Duke Ellington&#39;</span><span class='p'>,</span> <span class='s-Atom'>piano</span><span class='p'>).</span>
<span class='nf'>musician_instrument</span><span class='p'>(</span><span class='s-Atom'>&#39;Jimi Hendrix&#39;</span><span class='p'>,</span> <span class='s-Atom'>guitar</span><span class='p'>).</span>

<span class='nf'>musician_genre</span><span class='p'>(</span><span class='s-Atom'>&#39;Hansi Kurch&#39;</span><span class='p'>,</span> <span class='s-Atom'>metal</span><span class='p'>).</span>
<span class='nf'>musician_genre</span><span class='p'>(</span><span class='s-Atom'>&#39;Andre Olbrich&#39;</span><span class='p'>,</span> <span class='s-Atom'>metal</span><span class='p'>).</span>
<span class='nf'>musician_genre</span><span class='p'>(</span><span class='s-Atom'>&#39;Duke Ellington&#39;</span><span class='p'>,</span> <span class='s-Atom'>jazz</span><span class='p'>).</span>
<span class='nf'>musician_genre</span><span class='p'>(</span><span class='s-Atom'>&#39;Jimi Hendrix&#39;</span><span class='p'>,</span> <span class='s-Atom'>rock</span><span class='p'>).</span>
</code></pre>
</div>



<div class='question'>4. Find all musicians who play the guitar.</div>


<div class='highlight'><pre><code class='prolog'><span class='s-Atom'>?-</span> <span class='nf'>musician_instrument</span><span class='p'>(</span><span class='nv'>What</span><span class='p'>,</span> <span class='s-Atom'>guitar</span><span class='p'>)</span>

<span class='nv'>What</span> <span class='o'>=</span> <span class='s-Atom'>&#39;Andre Olbrich&#39;</span> <span class='s-Atom'>?</span> <span class='p'>;</span>

<span class='nv'>What</span> <span class='o'>=</span> <span class='s-Atom'>&#39;Jimi Hendrix&#39;</span>
</code></pre>
</div>



</div>
<p>Next in this series: <a href='/blog/2012/07/17/seven-languages-week-3-day-2'>Day 2 of Prolog</a></p>
  </div>

  <div style="margin-top:20px; font-size:14px;">
    <a href="/blog/2012/02/05/seven-languages-week-3-day-1/#disqus_thread" data-disqus-identifier="/blog/2012/02/05/seven-languages-week-3-day-1">Comments</a>
  </div>

    <hr class="fancyrule" />

  <div>
  <h1 style="margin:0px"><a href="/blog/2012/01/16/seven-languages-week-2-day-3/">
  Seven Languages: Week 2 (Io) - Day 3
  </a></h1>
  <div class="faded" style="font-size:14px; margin-bottom:5px;">16 Jan 2012</div>
  <p>Since this is the last day of Io, I am going to reflect a bit on what I liked about it.</p>

<p>I learned that a small prototype-based language like Io can still be expressive and powerful. There are no classes or modules, but you don&#8217;t need them to put things together in a way that mimics classes or modules. It was very refreshing.</p>

<p>It also turned out that I got a practical result directly relevant to my current work from learning Io: it strengthened my understanding of javascript. The underlying way javascript works makes sense to me on a deeper level now. I am actually in the middle of reading <a href='http://shop.oreilly.com/product/9780596517748.do'>Javascript: The Good Parts</a>, and I can glance at the parts to do with explaining prototypes and think &#8220;Aha! This is obvious and makes total sense to me!&#8221; I am positive I would not have thought the same before this experience.</p>

<p>Io&#8217;s minimalism also whetted my appetite for learning a lisp. Clojure is coming up in a few chapters, and I am looking forward to it. Scheme is also on my horizon (if a bit farther out), but that&#8217;s a subject for another post.</p>
<div class='interjection'><p>
(This article is part of a series of posts I am doing about my journey through the exercises of the book <a href='http://pragprog.com/book/btlang/seven-languages-in-seven-weeks'>Seven Languages In Seven Weeks</a>. The article previous to this one is <a href='/blog/2012/01/11/seven-languages-week-2-day-2/'>Week 2 (Io) - Day 2</a>. For an overview see the <a href='/projects/seven-languages-in-seven-weeks/'>project page</a>.)
</p></div>
<h2 id='topics_covered'>Topics covered</h2>

<p>The last day of Io covered some more advanced language features, mostly focused on metaprogramming.</p>

<p><strong>Metaprogramming and internal DSLs</strong> were the main focus of the text, the examples, and the exercises. But for good reason! Again Io&#8217;s firm commitment to letting you do whatever you want to (even up to the point of allowing you to cripple core language features!) shows the power it can give.</p>

<p>You can create custom behavior for curly brackets just by sticking a method into the <code>curlyBrackets</code> slot. You can redefine the colon operator by calling <code>addAssignOperator</code> with <code>:</code> and the name of the method you want to use. Io also has an equivalent to Ruby&#8217;s <code>method_missing</code>, except in Io it is called <code>forward</code> and it is a crucial part of prototypal inheritance.</p>

<p><strong>Example time!</strong> Say you send a message called <code>fly</code> to an object we&#8217;ll call <code>Mallard</code>. In this example, <code>Mallard</code> is a clone of the <code>Duck</code> prototype, and has some additional slots we don&#8217;t care about right now. The important thing is that <code>Mallard</code> <em>doesn&#8217;t</em> have a <code>fly</code> slot (it is probably defined in <code>Duck</code> or somewhere else further up the chain), so when we send the <code>fly</code> message to <code>Mallard</code> it will say &#8220;Huh, can&#8217;t do anything with this&#8221; and <em>forward</em> that message to its prototype to deal with.</p>

<p>Putting a method in the <code>forward</code> slot of an object lets us customize what happens when an object receives a message it doesn&#8217;t know what to do with. Instead of forwarding the message on to its prototype (as in the example above), we can start to do some pretty interesting things, which you will see in my highlights from the exercises.</p>

<p><strong>Concurrency</strong> was also talked about, and Bruce showed how Io can handle that with <strong>coroutines, actors, and futures</strong>. Futures and coroutines I am already familiar with, and it was nice to see how seamless they were to use in Io. I am pretty sure I didn&#8217;t really grok the section on actors.</p>

<p>In Io you can make an object into an actor just by sending an asynchronous message to it (which you do with <code>@@</code>). This may be cool but I&#8217;m not sure, because I don&#8217;t understand the implications of actors yet. Once I get to the Erlang section is likely when I&#8217;ll start learning more about them and this will start to be impressive in retrospect.</p>

<h2 id='highlights_from_exercises'>Highlights from exercises</h2>

<p>These exercises focused on expanding on the XML DSL example that was used to demonstrate <code>forward</code> during this chapter.</p>

<p>I was not really satisfied with my solution - I couldn&#8217;t manage to make it feel as elegant as my previous ones. It might be because this problem is inherently a little bit messy, or more likely, there are still some bumps in my implementation that could be smoothed out.</p>

<p>Io&#8217;s <code>forward</code> method, reflection abilities, and ability to redefine operators all played key roles in making a problem like this possible to solve with an internal (<a href='http://martinfowler.com/bliki/DomainSpecificLanguage.html'>as opposed to external</a>) DSL. This saved a ton of time and effort on my part.</p>
<h3>Forward</h3>
<p>This is a simple stripped down chunk from the XML DSL example from the book. It lets you make a rudimentary XML DSL. The following section of code will turn <code>Builder div</code> into <code>&lt;div&gt;&lt;/div&gt;</code>. The downside is, it will also turn <code>Builder
span</code> into <code>&lt;div&gt;&lt;/div&gt;</code>!</p>
<div class='highlight'><pre><code class='io'><span class='n'>Builder</span> <span class='o'>:=</span> <span class='n'>Object</span> <span class='k'>clone</span>

<span class='n'>Builder</span> <span class='n'>forward</span> <span class='o'>:=</span> <span class='k'>method</span><span class='o'>(</span>
    <span class='n'>write</span><span class='o'>(</span><span class='s'>&quot;&lt;div&gt;&quot;</span><span class='o'>)</span>
    <span class='n'>write</span><span class='o'>(</span><span class='s'>&quot;&lt;/div&gt;&quot;</span><span class='o'>)</span>
<span class='o'>)</span>
</code></pre>
</div><h3>Reflection</h3>
<p>Reflection in Io was covered in Day 2 of the book, but it is an important part of this example. It provides the ability to access the <em>name of the message</em> that was sent with <code>call message name</code>. It also lets us start nesting calls by passing another function call as an argument. This example is complete enough that we can do <code>Builder ul(li(&quot;One&quot;), li(&quot;Two&quot;), li(&quot;Three&quot;))</code> and it will correctly print out <code>&lt;ul&gt;&lt;li&gt;One&lt;/li&gt;&lt;li&gt;Two&lt;/li&gt;&lt;li&gt;Three&lt;/li&gt;&lt;/ul&gt;</code>.</p>
<div class='highlight'><pre><code class='io'><span class='n'>Builder</span> <span class='o'>:=</span> <span class='n'>Object</span> <span class='k'>clone</span>

<span class='n'>Builder</span> <span class='n'>forward</span> <span class='o'>:=</span> <span class='k'>method</span><span class='o'>(</span>
    <span class='n'>write</span><span class='o'>(</span><span class='s'>&quot;&lt;&quot;</span><span class='o'>,</span> <span class='n'>call</span> <span class='n'>message</span> <span class='n'>name</span><span class='o'>,</span> <span class='s'>&quot;&gt;&quot;</span><span class='o'>)</span>
    <span class='n'>call</span> <span class='n'>message</span> <span class='n'>arguments</span> <span class='n'>foreach</span><span class='o'>(</span>
        <span class='n'>arg</span><span class='o'>,</span>
        <span class='n'>content</span> <span class='o'>:=</span> <span class='n'>self</span> <span class='n'>doMessage</span><span class='o'>(</span><span class='n'>arg</span><span class='o'>);</span>
        <span class='k'>if</span><span class='o'>(</span><span class='n'>content</span> <span class='n'>type</span> <span class='o'>==</span> <span class='s'>&quot;Sequence&quot;</span><span class='o'>,</span> <span class='n'>write</span><span class='o'>(</span><span class='n'>content</span><span class='o'>)))</span>
    <span class='n'>write</span><span class='o'>(</span><span class='s'>&quot;&lt;/&quot;</span><span class='o'>,</span> <span class='n'>call</span> <span class='n'>message</span> <span class='n'>name</span><span class='o'>,</span> <span class='s'>&quot;&gt;&quot;</span><span class='o'>))</span>
</code></pre>
</div>
<p>Let&#8217;s go over that middle chunk that begins with <code>call message arguments</code>. Just as <code>call message name</code> will return the name, <code>call message arguments</code> returns a list of the arguments. We iterate over that list with <code>foreach</code>, and for each <code>arg</code> we do two things:</p>

<ol>
<li>Execute it with <code>self doMessage</code>. If the argument is another method call like <code>li(&quot;One&quot;)</code> then <code>Builder li</code> gets executed, <code>Builder</code> can&#8217;t find a slot with that name, and <code>forward</code> gets called again. We are recursing now, and this will continue until we hit an argument that is a simple string, like <code>&quot;One&quot;</code>. When we do, <code>doMessage</code> will just turn that argument into a string. This leads to the second step:</li>

<li>If the executing argument is a simple string (<code>if(content type == &quot;Sequence&quot;,</code>) then print it out!</li>
</ol>

<p>That&#8217;s enough for a simple XML DSL in Io. The exercises are about taking this base and expanding it to handle attributes and generate xml with correct indentation. If you&#8217;re interested in seeing that, just scroll down to my full code listing!</p>
<h3>Operator Redefinition</h3>
<p>Now that you&#8217;ve made it through that, let&#8217;s close with something easy. Exercise #2 was simple and served as a hint for the next one. In Io you can override what <code>{1, 2, 3}</code> means by putting a method into <code>curlyBrackets</code>. The contents <code>1</code>, <code>2</code>, and <code>3</code> will be available as the arguments of the message. If you were paying attention before, you&#8217;ll realize that we already know how to turn the message arguments into a list:</p>
<div class='highlight'><pre><code class='io'><span class='c1'># 2. Create a list syntax that uses brackets</span>
<span class='n'>curlyBrackets</span> <span class='o'>:=</span> <span class='k'>method</span><span class='o'>(</span>
    <span class='n'>call</span> <span class='n'>message</span> <span class='n'>arguments</span>
<span class='o'>)</span>
</code></pre>
</div>
<p>So that&#8217;s all that is required to solve that! But that isn&#8217;t the typical way to redefine operators in Io. I&#8217;ll leave you with a final example that shows you how to tell Io &#8220;when I use the <code>:</code> operator, I really want you to call the <code>atPutNumber</code> method instead&#8221;.</p>
<div class='highlight'><pre><code class='io'><span class='n'>OperatorTable</span> <span class='n'>addAssignOperator</span><span class='o'>(</span><span class='s'>&quot;:&quot;</span><span class='o'>,</span> <span class='s'>&quot;atPutNumber&quot;</span><span class='o'>)</span>

<span class='n'>Map</span> <span class='n'>atPutNumber</span> <span class='o'>:=</span> <span class='k'>method</span><span class='o'>(</span>
    <span class='c1'># your code goes here</span>
<span class='o'>)</span>
</code></pre>
</div>
<h2 id='full_solutions'>Full solutions</h2>

<p>Here is a nicely formatted version of my solutions to the exercises from Day 3 of Io. The home of the following code is <a href='https://github.com/nickknw/seven-languages-in-seven-weeks/blob/master/week-2-io/day3.io'>on github</a> with the other exercises.</p>
<div id='formatted_solutions'>

<h3>Code Given</h3>


<div class='highlight'><pre><code class='io'><span class='n'>Builder</span> <span class='o'>:=</span> <span class='n'>Object</span> <span class='k'>clone</span>

<span class='n'>Builder</span> <span class='n'>forward</span> <span class='o'>:=</span> <span class='k'>method</span><span class='o'>(</span>
    <span class='n'>writeln</span><span class='o'>(</span><span class='s'>&quot;&lt;&quot;</span><span class='o'>,</span> <span class='n'>call</span> <span class='n'>message</span> <span class='n'>name</span><span class='o'>,</span> <span class='s'>&quot;&gt;&quot;</span><span class='o'>)</span>
    <span class='n'>call</span> <span class='n'>message</span> <span class='n'>arguments</span> <span class='n'>foreach</span><span class='o'>(</span>
        <span class='n'>arg</span><span class='o'>,</span>
        <span class='n'>content</span> <span class='o'>:=</span> <span class='n'>self</span> <span class='n'>doMessage</span><span class='o'>(</span><span class='n'>arg</span><span class='o'>);</span>
        <span class='k'>if</span><span class='o'>(</span><span class='n'>content</span> <span class='n'>type</span> <span class='o'>==</span> <span class='s'>&quot;Sequence&quot;</span><span class='o'>,</span> <span class='n'>writeln</span><span class='o'>(</span><span class='n'>content</span><span class='o'>)))</span>
    <span class='n'>writeln</span><span class='o'>(</span><span class='s'>&quot;&lt;/&quot;</span><span class='o'>,</span> <span class='n'>call</span> <span class='n'>message</span> <span class='n'>name</span><span class='o'>,</span> <span class='s'>&quot;&gt;&quot;</span><span class='o'>)</span>
<span class='o'>)</span>
</code></pre>
</div>



<h3>Do: </h3>

<div class='question'><b>1.</b> Enhance the XML program to add spaces to show the indentation
structure</div>


<div class='highlight'><pre><code class='io'><span class='n'>Builder</span> <span class='n'>indentLevel</span> <span class='o'>:=</span> <span class='mf'>0</span>

<span class='n'>Builder</span> <span class='n'>forward</span> <span class='o'>=</span> <span class='k'>method</span><span class='o'>(</span>
    <span class='n'>writeln</span><span class='o'>(</span><span class='n'>makeIndent</span><span class='o'>()</span> <span class='o'>..</span> <span class='s'>&quot;&lt;&quot;</span><span class='o'>,</span> <span class='n'>call</span> <span class='n'>message</span> <span class='n'>name</span><span class='o'>,</span> <span class='s'>&quot;&gt;&quot;</span><span class='o'>)</span>
    <span class='n'>indentLevel</span> <span class='o'>=</span> <span class='n'>indentLevel</span> <span class='o'>+</span> <span class='mf'>1</span>
    <span class='n'>call</span> <span class='n'>message</span> <span class='n'>arguments</span> <span class='n'>foreach</span><span class='o'>(</span>
        <span class='n'>arg</span><span class='o'>,</span>
        <span class='n'>content</span> <span class='o'>:=</span> <span class='n'>self</span> <span class='n'>doMessage</span><span class='o'>(</span><span class='n'>arg</span><span class='o'>);</span>
        <span class='k'>if</span><span class='o'>(</span><span class='n'>content</span> <span class='n'>type</span> <span class='o'>==</span> <span class='s'>&quot;Sequence&quot;</span><span class='o'>,</span> <span class='n'>writeln</span><span class='o'>(</span><span class='n'>makeIndent</span><span class='o'>()</span> <span class='o'>..</span> <span class='n'>content</span><span class='o'>))</span>
    <span class='o'>)</span>
    <span class='n'>indentLevel</span> <span class='o'>=</span> <span class='n'>indentLevel</span> <span class='o'>-</span> <span class='mf'>1</span>
    <span class='n'>writeln</span><span class='o'>(</span><span class='n'>makeIndent</span><span class='o'>()</span> <span class='o'>..</span> <span class='s'>&quot;&lt;/&quot;</span><span class='o'>,</span> <span class='n'>call</span> <span class='n'>message</span> <span class='n'>name</span><span class='o'>,</span> <span class='s'>&quot;&gt;&quot;</span><span class='o'>)</span>
<span class='o'>)</span>

<span class='n'>Builder</span> <span class='n'>makeIndent</span> <span class='o'>:=</span> <span class='k'>method</span><span class='o'>(</span>
    <span class='n'>spaces</span> <span class='o'>:=</span> <span class='s'>&quot;&quot;</span>
    <span class='n'>indentLevel</span> <span class='n'>repeat</span><span class='o'>(</span><span class='n'>spaces</span> <span class='o'>=</span> <span class='n'>spaces</span> <span class='o'>..</span> <span class='s'>&quot;  &quot;</span><span class='o'>)</span>
    <span class='n'>return</span> <span class='n'>spaces</span>
<span class='o'>)</span>

<span class='n'>Builder</span> <span class='n'>ul</span><span class='o'>(</span>
    <span class='n'>li</span><span class='o'>(</span><span class='s'>&quot;Io&quot;</span><span class='o'>),</span>
    <span class='n'>li</span><span class='o'>(</span><span class='s'>&quot;Lua&quot;</span><span class='o'>),</span>
    <span class='n'>li</span><span class='o'>(</span><span class='s'>&quot;JavaScript&quot;</span><span class='o'>)</span>
<span class='o'>)</span>
</code></pre>
</div>



<div class='tiny_title'>Output</div>


<div class='highlight'><pre><code class='html'><span class='nt'>&lt;ul&gt;</span>
  <span class='nt'>&lt;li&gt;</span>
    Io
  <span class='nt'>&lt;/li&gt;</span>
  <span class='nt'>&lt;li&gt;</span>
    Lua
  <span class='nt'>&lt;/li&gt;</span>
  <span class='nt'>&lt;li&gt;</span>
    JavaScript
  <span class='nt'>&lt;/li&gt;</span>
<span class='nt'>&lt;/ul&gt;</span>
</code></pre>
</div>



<div class='question'><b>2.</b> Create a list syntax that uses brackets</div>


<div class='highlight'><pre><code class='io'><span class='n'>curlyBrackets</span> <span class='o'>:=</span> <span class='k'>method</span><span class='o'>(</span>
    <span class='n'>call</span> <span class='n'>message</span> <span class='n'>arguments</span>
<span class='o'>)</span>

<span class='o'>{</span><span class='mf'>1</span><span class='o'>,</span><span class='mf'>2</span><span class='o'>,</span><span class='mf'>3</span><span class='o'>,</span><span class='mf'>4</span><span class='o'>,</span><span class='mf'>5</span><span class='o'>}</span> <span class='n'>println</span>
<span class='o'>{</span><span class='s'>&quot;a&quot;</span><span class='o'>,</span> <span class='s'>&quot;b&quot;</span><span class='o'>,</span> <span class='s'>&quot;c&quot;</span><span class='o'>,</span> <span class='s'>&quot;d&quot;</span><span class='o'>,</span> <span class='s'>&quot;e&quot;</span><span class='o'>}</span> <span class='n'>println</span>

<span class='c1'># that was unexpectedly easy and elegant. I almost feel like I&#39;ve missed something</span>
</code></pre>
</div>



<div class='tiny_title'>Output</div>


<div class='highlight'><pre><code class='io'><span class='n'>list</span><span class='o'>(</span><span class='mf'>1</span><span class='o'>,</span> <span class='mf'>2</span><span class='o'>,</span> <span class='mf'>3</span><span class='o'>,</span> <span class='mf'>4</span><span class='o'>,</span> <span class='mf'>5</span><span class='o'>)</span>
<span class='n'>list</span><span class='o'>(</span><span class='s'>&quot;a&quot;</span><span class='o'>,</span> <span class='s'>&quot;b&quot;</span><span class='o'>,</span> <span class='s'>&quot;c&quot;</span><span class='o'>,</span> <span class='s'>&quot;d&quot;</span><span class='o'>,</span> <span class='s'>&quot;e&quot;</span><span class='o'>)</span>
</code></pre>
</div>




<div class='question'><b>3.</b> Enhance the XML program to handle attributes: if the first argument is a map (use the curly brackets syntax), add attributes to the XML program. For example: book({"author": "Tate"}...) would print &lt;book author="Tate"&gt;</div>


<div class='highlight'><pre><code class='io'><span class='n'>OperatorTable</span> <span class='n'>addAssignOperator</span><span class='o'>(</span><span class='s'>&quot;:&quot;</span><span class='o'>,</span> <span class='s'>&quot;atPutNumber&quot;</span><span class='o'>)</span>

<span class='n'>Map</span> <span class='n'>atPutNumber</span> <span class='o'>:=</span> <span class='k'>method</span><span class='o'>(</span>
    <span class='n'>self</span> <span class='n'>atPut</span><span class='o'>(</span>
        <span class='n'>call</span> <span class='n'>evalArgAt</span><span class='o'>(</span><span class='mf'>0</span><span class='o'>)</span> <span class='n'>asMutable</span> <span class='n'>removePrefix</span><span class='o'>(</span><span class='s'>&quot;\&quot;&quot;</span><span class='o'>)</span> <span class='n'>removeSuffix</span><span class='o'>(</span><span class='s'>&quot;\&quot;&quot;</span><span class='o'>),</span>
        <span class='n'>call</span> <span class='n'>evalArgAt</span><span class='o'>(</span><span class='mf'>1</span><span class='o'>)</span>
    <span class='o'>)</span>
<span class='o'>)</span>
        
<span class='n'>curlyBrackets</span> <span class='o'>:=</span> <span class='k'>method</span><span class='o'>(</span>
    <span class='n'>r</span> <span class='o'>:=</span> <span class='n'>Map</span> <span class='k'>clone</span>
    <span class='n'>call</span> <span class='n'>message</span> <span class='n'>arguments</span> <span class='n'>foreach</span><span class='o'>(</span><span class='n'>arg</span><span class='o'>,</span>
        <span class='n'>r</span> <span class='n'>doMessage</span><span class='o'>(</span><span class='n'>arg</span><span class='o'>)</span>
    <span class='o'>)</span>
    <span class='n'>r</span>
<span class='o'>)</span>

<span class='n'>Map</span> <span class='n'>printAsAttributes</span> <span class='o'>:=</span> <span class='k'>method</span><span class='o'>(</span>
    <span class='n'>self</span> <span class='n'>foreach</span><span class='o'>(</span><span class='n'>k</span><span class='o'>,</span> <span class='n'>v</span><span class='o'>,</span>
        <span class='n'>write</span><span class='o'>(</span><span class='s'>&quot; &quot;</span> <span class='o'>..</span> <span class='n'>k</span> <span class='o'>..</span> <span class='s'>&quot;=\&quot;&quot;</span> <span class='o'>..</span> <span class='n'>v</span> <span class='o'>..</span> <span class='s'>&quot;\&quot;&quot;</span><span class='o'>)</span>
    <span class='o'>)</span>
<span class='o'>)</span>

<span class='n'>Builder</span> <span class='n'>forward</span> <span class='o'>=</span> <span class='k'>method</span><span class='o'>(</span>
    <span class='n'>write</span><span class='o'>(</span><span class='n'>makeIndent</span><span class='o'>()</span> <span class='o'>..</span> <span class='s'>&quot;&lt;&quot;</span><span class='o'>,</span> <span class='n'>call</span> <span class='n'>message</span> <span class='n'>name</span><span class='o'>)</span>
    <span class='n'>indentLevel</span> <span class='o'>=</span> <span class='n'>indentLevel</span> <span class='o'>+</span> <span class='mf'>1</span>
    <span class='n'>isFirst</span> <span class='o'>:=</span> <span class='no'>true</span>
    <span class='n'>call</span> <span class='n'>message</span> <span class='n'>arguments</span> <span class='n'>foreach</span><span class='o'>(</span>
        <span class='n'>arg</span><span class='o'>,</span>
        <span class='k'>if</span><span class='o'>(</span><span class='n'>isFirst</span><span class='o'>,</span>
            <span class='k'>if</span><span class='o'>(</span><span class='n'>arg</span> <span class='n'>name</span> <span class='o'>==</span> <span class='s'>&quot;curlyBrackets&quot;</span><span class='o'>,</span> 
                <span class='o'>(</span><span class='n'>self</span> <span class='n'>doMessage</span><span class='o'>(</span><span class='n'>arg</span><span class='o'>))</span> <span class='n'>printAsAttributes</span>
            <span class='o'>)</span>

            <span class='n'>write</span><span class='o'>(</span><span class='s'>&quot;&gt;\n&quot;</span><span class='o'>)</span>
            <span class='n'>isFirst</span> <span class='o'>=</span> <span class='no'>false</span>
        <span class='o'>)</span>

        <span class='n'>content</span> <span class='o'>:=</span> <span class='n'>self</span> <span class='n'>doMessage</span><span class='o'>(</span><span class='n'>arg</span><span class='o'>)</span>
        <span class='k'>if</span><span class='o'>(</span><span class='n'>content</span> <span class='n'>type</span> <span class='o'>==</span> <span class='s'>&quot;Sequence&quot;</span><span class='o'>,</span> <span class='n'>writeln</span><span class='o'>(</span><span class='n'>makeIndent</span><span class='o'>()</span> <span class='o'>..</span> <span class='n'>content</span><span class='o'>))</span>
    <span class='o'>)</span>
    <span class='n'>indentLevel</span> <span class='o'>=</span> <span class='n'>indentLevel</span> <span class='o'>-</span> <span class='mf'>1</span>
    <span class='n'>writeln</span><span class='o'>(</span><span class='n'>makeIndent</span><span class='o'>()</span> <span class='o'>..</span> <span class='s'>&quot;&lt;/&quot;</span><span class='o'>,</span> <span class='n'>call</span> <span class='n'>message</span> <span class='n'>name</span><span class='o'>,</span> <span class='s'>&quot;&gt;&quot;</span><span class='o'>)</span>
<span class='o'>)</span>

<span class='n'>s</span> <span class='o'>:=</span> <span class='n'>File</span> <span class='n'>with</span><span class='o'>(</span><span class='s'>&quot;builderSyntax.txt&quot;</span><span class='o'>)</span> <span class='n'>openForReading</span> <span class='n'>contents</span>
<span class='k'>doString</span><span class='o'>(</span><span class='n'>s</span><span class='o'>)</span>
</code></pre>
</div>



<div class='tiny_title'>Output</div>


<div class='highlight'><pre><code class='html'><span class='nt'>&lt;ul&gt;</span>
  <span class='nt'>&lt;li&gt;</span>
    Io
  <span class='nt'>&lt;/li&gt;</span>
  <span class='nt'>&lt;li</span> <span class='na'>display=</span><span class='s'>&quot;none&quot;</span><span class='nt'>&gt;</span>
    Lua
  <span class='nt'>&lt;/li&gt;</span>
  <span class='nt'>&lt;li&gt;</span>
    JavaScript
  <span class='nt'>&lt;/li&gt;</span>
  <span class='nt'>&lt;book</span> <span class='na'>author=</span><span class='s'>&quot;Tate&quot;</span><span class='nt'>&gt;</span>
  <span class='nt'>&lt;/book&gt;</span>
<span class='nt'>&lt;/ul&gt;</span>
</code></pre>
</div>



</div>
<p>Next in this series: <a href='/blog/2012/02/05/seven-languages-week-3-day-1/'>Day 1 of Prolog</a></p>
  </div>

  <div style="margin-top:20px; font-size:14px;">
    <a href="/blog/2012/01/16/seven-languages-week-2-day-3/#disqus_thread" data-disqus-identifier="/blog/2012/01/16/seven-languages-week-2-day-3">Comments</a>
  </div>

    <hr class="fancyrule" />


<a href="/blog/archive/">← Older posts</a>

  <script type="text/javascript">
      var disqus_shortname = 'nickknowlson'; 
  
      (function () {
          var s = document.createElement('script'); s.async = true;
          s.type = 'text/javascript';
          s.src = 'http://' + disqus_shortname + '.disqus.com/count.js';
          (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
      }());
  </script>

            </div>
        </div>
        <div id="footer">&copy; Copyright 2012 Nick Knowlson</div>
        <div style="display: none;">Content by Nick Knowlson: <a href="https://plus.google.com/104462106474002996122?rel=author" rel="me">Google+</a></div>
        <!--hacky way of reducing image loading lag when hovering over rss and twitter icons for now --><span style="display: none;"><img src="/img/rss-icon-lit.png" /><img src="/img/twitter-icon-lit.png" /></span>
    </body>
</html>
